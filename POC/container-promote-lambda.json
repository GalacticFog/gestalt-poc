{
    "resource_type": "Gestalt::Resource::Node::Lambda",
    "name": "container-promote",
    "description": "Container Migration Lambda",
    "properties": {
        "env": {
            "META_URL": "http://gestalt-meta.gestalt-system:10131",
            "API_KEY": "15c0bcd4-641e-4807-97f0-16e8afa40858",
            "API_SECRET": "m6g3BMz3jKrk7SMnp0rEPgKh2k04VNy9Ured/N3E"
        },
        "headers": {
            "Accept": "text/plain",
            "Content-Type": "text/plain"
        },
        "code": "Ly8gVGhpcyBwcm9tb3Rpb24gZnVuY3Rpb24gZG9lcyB0aGUgZm9sbG93aW5nOgovLyAgLSBVcGRhdGVzIHRoZSBleGlzdGluZyBjb250YWluZXIgaW4gdGhlIHRhcmdldCBlbnZpb3JubWVudCBpZiBpdCBleGlzdHMsIG9yCi8vICAtIENyZWF0ZXMgYSBuZXcgY29udGFpbmVyIGluIHRoZSB0YXJnZXQgZW52aXJvbm1lbnQKLy8gICAgLSBTZXQgbnVtX2luc3RhbmNlcyA9IDEgKG9yIDAgaWYgb3JpZ2luYWwgd2FzIHNjYWxlZCBkb3duKSBldmVuIGlmIG9yaWdpbmFsIGluc3RhbmNlcyB3YXMgPiAxCi8vICAgIC0gU2V0cyB0aGUgY29udGFpbmVyIGRlc2NyaXB0aW9uIHRvIGluZGljYXRlIHRoZSBwcm9tb3Rpb24KLy8KLy8gUmVxdWlyZWQgTWV0YSB2YXJpYWJsZXMKLy8gICBNRVRBX1VSTCI6ICJodHRwOi8vZ2VzdGFsdC1tZXRhLmdlc3RhbHQtc3lzdGVtOjEwMTMxIiwKLy8gICBBUElfS0VZIjogIi4uLi4uLi4uLi4iLAovLyAgIEFQSV9TRUNSRVQiOiAiLi4uLi4uLi4uLi4uLiIKCmZ1bmN0aW9uIHByb21vdGUoYXJncywgY3R4KSB7CiAgICBsb2coIioqKioqIGJlZ2luIHByb21vdGUgKioqKioqKioqKioqIik7CgogICAgYXJncyA9IEpTT04ucGFyc2UoIGFyZ3MgKTsKICAgIGN0eCAgPSBKU09OLnBhcnNlKCBjdHggKTsKCiAgICBNRVRBID0gZ2V0X21ldGEoYXJncywgY3R4LmNyZWRzKTsKICAgIGxvZygiW2luaXRdIGZvdW5kIG1ldGE6ICIgKyBNRVRBLnVybCk7CgogICAgdmFyIHRndF9lbnZfaWQgPSBhcmdzLnRhcmdldF9lbnZfaWQ7CiAgICB2YXIgY3VyX2Vudl9pZCA9IGFyZ3MuZW52aXJvbm1lbnRfaWQ7CgogICAgdmFyIGN1cl9hcHAgICAgPSBhcmdzLnJlc291cmNlOwoKICAgIHZhciBwYXJlbnRfb3JnID0gZmluZF9vcmcoYXJncy5mcW9uKTsKCiAgICB2YXIgY3VyX2VudiA9IGZpbmRfZW52aXJvbm1lbnQocGFyZW50X29yZywgY3VyX2Vudl9pZCk7CiAgICB2YXIgdGd0X2VudiA9IGZpbmRfZW52aXJvbm1lbnQocGFyZW50X29yZywgdGd0X2Vudl9pZCk7CgogICAgbG9nKCJyZXF1ZXN0IHRvIHByb21vdGUgY29udGFpbmVyICIgKyBjdXJfYXBwLm5hbWUgKyAiIGZyb20gIiArIGN1cl9lbnYubmFtZSArICIgdG8gZW52aXJvbm1lbnQgIiArIHRndF9lbnYubmFtZSk7CgogICAgdmFyIHRndF9hcHAgPSBmaW5kX2NvbnRhaW5lcl9ieV9uYW1lKHBhcmVudF9vcmcsIHRndF9lbnYsIGN1cl9hcHAubmFtZSk7CiAgICBpZiAoICEgdGd0X2FwcCApIHsKICAgICAgICAvLyBsb2coIkVSUk9SOiBjb3VsZCBub3QgbG9jYXRlIHRhcmdldCBjb250YWluZXIgaW4gZW52aXJvbm1lbnQgIiArIHRndF9lbnYubmFtZSArICIgd2l0aCBuYW1lICIgKyBjdXJfYXBwLm5hbWUpOwogICAgICAgIC8vIHJldHVybiBnZXRMb2coKTsKCiAgICAgICAgdmFyIG5ld19hcHA7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIG9wID0gY3VyX2FwcC5wcm9wZXJ0aWVzOwogICAgICAgICAgICB2YXIgY3VyX251bV9pbnN0YW5jZXMgPSBKU09OLnBhcnNlKG9wLm51bV9pbnN0YW5jZXMpOwogICAgICAgICAgICBuZXdfYXBwID0gY3JlYXRlX2NvbnRhaW5lcihwYXJlbnRfb3JnLCB0Z3RfZW52LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAgICAgICAgY3VyX2FwcC5uYW1lLAogICAgICAgICAgICAgICAgLy8gZGVzY3JpcHRpb246IGN1cl9hcHAuZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIlByb21vdGVkIGF0ICIgKyBTdHJpbmcoRGF0ZSgpKSwKICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgICAgICBwcm92aWRlcjogewogICAgICAgICAgICAgICAgICAgICAgICBpZDogb3AucHJvdmlkZXIuaWQKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG51bV9pbnN0YW5jZXM6ICBjdXJfbnVtX2luc3RhbmNlcyA+IDAgPyBjdXJfbnVtX2luc3RhbmNlcyA6IDEsCiAgICAgICAgICAgICAgICAgICAgY3B1czogICAgICAgICAgIG9wLmNwdXMsCiAgICAgICAgICAgICAgICAgICAgbWVtb3J5OiAgICAgICAgIG9wLm1lbW9yeSwKICAgICAgICAgICAgICAgICAgICBkaXNrOiAgICAgICAgICAgb3AuZGlzaywKICAgICAgICAgICAgICAgICAgICBjb250YWluZXJfdHlwZTogb3AuY29udGFpbmVyX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6ICAgICAgICAgIG9wLmltYWdlLAogICAgICAgICAgICAgICAgICAgIG5ldHdvcms6ICAgICAgICBvcC5uZXR3b3JrLAogICAgICAgICAgICAgICAgICAgIGhlYWx0aF9jaGVja3M6ICBvcC5oZWFsdGhfY2hlY2tzID8gb3AuaGVhbHRoX2NoZWNrcyA6IFtdLAogICAgICAgICAgICAgICAgICAgIHBvcnRfbWFwcGluZ3M6ICBvcC5wb3J0X21hcHBpbmdzID8gb3AucG9ydF9tYXBwaW5ncyA6IFtdLAogICAgICAgICAgICAgICAgICAgIGxhYmVsczogICAgICAgICBvcC5sYWJlbHMgICAgICAgID8gb3AubGFiZWxzICAgICAgICA6IHt9LAogICAgICAgICAgICAgICAgICAgIGVudjogICAgICAgICAgICBvcC5lbnYgICAgICAgICAgID8gb3AuZW52ICAgICAgICAgICA6IHt9LAogICAgICAgICAgICAgICAgICAgIHZvbHVtZXMgOiAgICAgICBvcC52b2x1bWVzICAgICAgID8gb3Audm9sdW1lcyAgICAgICA6IFtdLAogICAgICAgICAgICAgICAgICAgIGZvcmNlX3B1bGwgOiAgICBvcC5mb3JjZV9wdWxsICAgID8gb3AuZm9yY2VfcHVsbCAgICA6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzIDogICBvcC5jb25zdHJhaW50cyAgID8gb3AuY29uc3RyYWludHMgICA6IFtdLAogICAgICAgICAgICAgICAgICAgIGFjY2VwdGVkX3Jlc291cmNlX3JvbGVzOiBvcC5hY2NlcHRlZF9yZXNvdXJjZV9yb2xlcyA/IG9wLmFjY2VwdGVkX3Jlc291cmNlX3JvbGVzIDogW10sCiAgICAgICAgICAgICAgICAgICAgYXJncyA6ICAgICAgICAgIG9wLmFyZ3MsCiAgICAgICAgICAgICAgICAgICAgY21kOiAgICAgICAgICAgIG9wLmNtZCwKICAgICAgICAgICAgICAgICAgICB1c2VyOiAgICAgICAgICAgb3AudXNlcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNoKGVycikgewogICAgICAgICAgICBsb2coIkVSUk9SOiBlcnJvciBjcmVhdGluZyBjb250YWluZXI6IHJlc3BvbnNlIGNvZGUgIiArIGVycik7CiAgICAgICAgICAgIHJldHVybiBnZXRMb2coKTsKICAgICAgICB9CiAgICAgICAgbG9nKCJDcmVhdGVkIG5ldyBjb250YWluZXIgd2l0aCBpZCAiICsgbmV3X2FwcC5pZCk7CiAgICAgICAgcmV0dXJuIGdldExvZygpOwogICAgfQoKICAgIC8vIE90aGVyd2lzZSwgbW9kaWZ5IHRoZSBleGlzdGluZyBjb250YWluZXIKCiAgICBsb2coImxvY2F0ZWQgdGFyZ2V0IGFwcCAiICsgZGlzcCh0Z3RfYXBwKSApOwoKICAgIHRyeSB7CiAgICAgICAgcGF0Y2hfY29udGFpbmVyKHBhcmVudF9vcmcsIHRndF9lbnYsIHRndF9hcHAsIFsKICAgICAgICAgICAgcmVwbGFjZSgiaW1hZ2UiLCBjdXJfYXBwLnByb3BlcnRpZXMuaW1hZ2UpLAogICAgICAgICAgICByZXBsYWNlKCJlbnYiLCAgIGN1cl9hcHAucHJvcGVydGllcy5lbnYpCiAgICAgICAgXSk7CiAgICB9IGNhdGNoKGVycikgewogICAgICAgIGxvZygiRVJST1I6IGVycm9yIGNyZWF0aW5nIGNvbnRhaW5lcjogcmVzcG9uc2UgY29kZSAiICsgZXJyKTsKICAgICAgICByZXR1cm4gZ2V0TG9nKCk7CiAgICB9CiAgICBsb2coIkNvbnRhaW5lciBzdWNjZXNzZnVsbHkgbWlncmF0ZWQuIik7CgogICAgbG9nKCIqKioqKiBlbmQgcHJvbW90ZSAqKioqKioqKioqKioqKiIpOwogICAgcmV0dXJuICJDb250YWluZXIgbWlncmF0ZWQuIjsKfQoKZnVuY3Rpb24gcmVwbGFjZShwcm9wX3BhdGgsIHZhbHVlKSB7CiAgICByZXR1cm4gewogICAgICAgIG9wOiAicmVwbGFjZSIsCiAgICAgICAgcGF0aDogIi9wcm9wZXJ0aWVzLyIgKyBwcm9wX3BhdGgsCiAgICAgICAgdmFsdWU6IHZhbHVlCiAgICB9Cn0KCgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0gU0RLIGZ1bmN0aW9ucyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCgp2YXIgQXN5bmNIdHRwQ2xpZW50ICAgPSBKYXZhLnR5cGUoJ29yZy5hc3luY2h0dHBjbGllbnQuRGVmYXVsdEFzeW5jSHR0cENsaWVudCcpOwp2YXIgQ29tcGxldGFibGVGdXR1cmUgPSBKYXZhLnR5cGUoJ2phdmEudXRpbC5jb25jdXJyZW50LkNvbXBsZXRhYmxlRnV0dXJlJyk7Cgp2YXIgTUVUQSAgID0gbnVsbDsKdmFyIExPR19BUFBFTkRFUiA9IG5ldyBqYXZhLmxhbmcuU3RyaW5nQnVmZmVyKCk7CnZhciBjbGllbnQgPSBuZXcgQXN5bmNIdHRwQ2xpZW50KCk7Cgp2YXIgRW52aXJvbm1lbnRUeXBlcyA9IHsKICAgIERFVkVMT1BNRU5UOiAiZGV2ZWxvcG1lbnQiLAogICAgUFJPRFVDVElPTjogInByb2R1Y3Rpb24iLAogICAgVEVTVDogInRlc3QiCn07Cgp2YXIgUHJvdmlkZXJUeXBlcyA9IHsKICAgIC8vIGZvciBzZWFyY2gKICAgIEdBVEVXQVlNQU5BR0VSOiAiR2F0ZXdheU1hbmFnZXIiLAogICAgS09ORzogIktvbmciLAogICAgQ0FBUzogIkNhYVMiLAogICAgTEFNQkRBOiAiTGFtYmRhIiwKICAgIC8vIGZvciBjcmVhdGUKICAgIERDT1M6ICJHZXN0YWx0OjpDb25maWd1cmF0aW9uOjpQcm92aWRlcjo6Q2FhUzo6RENPUyIsCiAgICBLVUJFOiAiR2VzdGFsdDo6Q29uZmlndXJhdGlvbjo6UHJvdmlkZXI6OkNhYVM6Okt1YmVybmV0ZXMiCn07Cgp2YXIgRk9SQ0VfREVMRVRFID0gdHJ1ZTsKdmFyIERPX0FTWU5DID0gdHJ1ZTsKCnZhciBMb2dnaW5nTGV2ZWxzID0gewogICAgRVJST1I6IDMsCiAgICBXQVJOSU5HOiAyLAogICAgSU5GTzogMSwKICAgIERFQlVHOiAwCn07CgpmdW5jdGlvbiBnZXRBcHBMb2dMZXZlbCgpIHsKICAgIGlmIChnZXRfZW52KCJMT0dfREVCVUciLCAiZmFsc2UiKSA9PSAidHJ1ZSIpIHsKICAgICAgICBjb25zb2xlLmxvZygiZW5hYmxpbmcgZGVidWcgbG9nZ2luZyIpOwogICAgICAgIExPR19BUFBFTkRFUi5hcHBlbmQoImVuYWJsaW5nIGRlYnVnIGxvZ2dpbmdcbiIpOwogICAgICAgIHJldHVybiBMb2dnaW5nTGV2ZWxzLkRFQlVHOwogICAgfQogICAgcmV0dXJuIExvZ2dpbmdMZXZlbHMuSU5GTzsKfQoKdmFyIGxvZ2dpbmdMZXZlbHMgPSB7CiAgICBhcHBsb2c6ICBnZXRBcHBMb2dMZXZlbCgpLAogICAgY29uc29sZTogTG9nZ2luZ0xldmVscy5ERUJVRwp9OwoKZnVuY3Rpb24gZ2V0X2VudihrZXksZGVmKSB7CiAgICB2YXIgdmFsID0gamF2YS5sYW5nLlN5c3RlbS5nZXRlbnYoKS5nZXQoa2V5KTsKICAgIGlmICh2YWwpIHJldHVybiB2YWw7CiAgICBpZiAoZGVmKSByZXR1cm4gZGVmOwogICAgdGhyb3cgIkVudiBtaXNzaW5nIHZhcmlhYmxlICIgKyBrZXk7Cn0KCmZ1bmN0aW9uIGdldF9tZXRhKGFyZ3MsIGMpIHsKICAgIGxvZyhjLCBMb2dnaW5nTGV2ZWxzLkRFQlVHKTsKICAgIGxvZyhhcmdzLCBMb2dnaW5nTGV2ZWxzLkRFQlVHKTsKICAgIGlmIChhcmdzICYmIGFyZ3MubWV0YV91cmwpIHsKICAgICAgICB2YXIgbWV0YV91cmwgPSBhcmdzLm1ldGFfdXJsOwogICAgfSBlbHNlIHsKICAgICAgICB2YXIgbWV0YV91cmwgPSBnZXRfZW52KCJNRVRBX1VSTCIpOwogICAgfQoKICAgIHZhciBjdHggPSBudWxsOwogICAgdmFyIGNyZWRzID0gbnVsbDsKICAgIGlmICh0eXBlb2YoYykgPT09ICdvYmplY3QnKSB7CiAgICAgICAgbG9nKCJnZXRfbWV0YTogcmVjdmQgY29udGV4dCIsIExvZ2dpbmdMZXZlbHMuREVCVUcpOwogICAgICAgIGN0eCA9IGM7CiAgICB9IGVsc2UgaWYgKHR5cGVvZihjKSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBsb2coImdldF9tZXRhOiByZWN2ZCBjcmVkcyIsIExvZ2dpbmdMZXZlbHMuREVCVUcpOwogICAgICAgIGNyZWRzID0gYzsKICAgIH0KCiAgICBpZiAoIWNyZWRzIHx8IGNyZWRzID09PSAiIikgewogICAgICAgIGxvZygiZ2V0X21ldGE6IGNyZWRzIGFic2VudCwgZXhhbWluaW5nIGNvbnRleHQiLCBMb2dnaW5nTGV2ZWxzLkRFQlVHKTsKICAgICAgICBpZiAoY3R4ICYmIGN0eC5jcmVkcykgewogICAgICAgICAgICBsb2coImdldF9tZXRhOiBjcmVkcyBwcmVzZW50IGluIGNvbnRleHQiLCBMb2dnaW5nTGV2ZWxzLkRFQlVHKTsKICAgICAgICAgICAgY3JlZHMgPSBjdHguY3JlZHM7CiAgICAgICAgfQogICAgICAgIGlmICggISBjcmVkcyAmJiBjdHggJiYgY3R4LmhlYWRlcnMgJiYgY3R4LmhlYWRlcnMuQ29va2llKSB7CiAgICAgICAgICAgIGxvZygiZ2V0X21ldGE6IGNvb2tpZXMgcHJlc2VudCBpbiBjb250ZXh0LCBleGFtaW5pbmciLCBMb2dnaW5nTGV2ZWxzLkRFQlVHKTsKICAgICAgICAgICAgY29va2llcyA9IGN0eC5oZWFkZXJzLkNvb2tpZS5zcGxpdCgiOyIpOwogICAgICAgICAgICBmb3IgZWFjaCAoYyBpbiBjb29raWVzKSB7CiAgICAgICAgICAgICAgICBjID0gYy50cmltKCk7CiAgICAgICAgICAgICAgICBpID0gYy5pbmRleE9mKCI9Iik7CiAgICAgICAgICAgICAgICBpZiAoaSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGMuc3Vic3RyKDAsaSk7CiAgICAgICAgICAgICAgICAgICAgbG9nKCJnZXRfbWV0YTogZm91bmQgY29va2llOiAiICsgbmFtZSwgTG9nZ2luZ0xldmVscy5ERUJVRyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdhdXRoX3Rva2VuJykgewogICAgICAgICAgICAgICAgICAgICAgICBsb2coImdldF9tZXRhOiBmb3VuZCBjcmVkcyBpbiAnYXV0aF90b2tlbicgY29va2llIiwgTG9nZ2luZ0xldmVscy5ERUJVRyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRzID0gIkJlYXJlciAiICsgZGVjb2RlVVJJQ29tcG9uZW50KGMuc3Vic3RyKGkrMSkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAhIGNyZWRzICkgewogICAgICAgICAgICB2YXIgYXBpX2tleSA9IGdldF9lbnYoIkFQSV9LRVkiKTsKICAgICAgICAgICAgdmFyIGFwaV9zZWNyZXQgPSBnZXRfZW52KCJBUElfU0VDUkVUIik7CiAgICAgICAgICAgIGNyZWRzID0gIkJhc2ljICIgKyBqYXZheC54bWwuYmluZC5EYXRhdHlwZUNvbnZlcnRlci5wcmludEJhc2U2NEJpbmFyeSgoYXBpX2tleSArICI6IiArIGFwaV9zZWNyZXQpLmdldEJ5dGVzKCkpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgdXJsOiBtZXRhX3VybCwKICAgICAgICBjcmVkczogY3JlZHMKICAgIH0KfQoKCmZ1bmN0aW9uIGdldExvZygpIHsKICAgIHJldHVybiBMT0dfQVBQRU5ERVIudG9TdHJpbmcoKTsKfQoKZnVuY3Rpb24gbG9nKGEsIGx2bCkgewogICAgdmFyIHN0cjsKICAgIGlmICggYSA9PT0gdW5kZWZpbmVkICkgewogICAgICAgIHN0ciA9ICJ1bmRlZmluZWQiOwogICAgfQogICAgZWxzZSBpZiAoIGEgPT09IG51bGwgKSB7CiAgICAgICAgc3RyID0gIm51bGwiOwogICAgfQogICAgZWxzZSBpZiAodHlwZW9mKGEpID09PSAnb2JqZWN0JykgewogICAgICAgIHN0ciA9IEpTT04uc3RyaW5naWZ5KGEpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgc3RyID0gYS50b1N0cmluZygpOwogICAgfQogICAgaWYgKGx2bCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbHZsID0gTG9nZ2luZ0xldmVscy5JTkZPOwogICAgfQogICAgaWYgKGx2bCA+PSBsb2dnaW5nTGV2ZWxzLmNvbnNvbGUpIGNvbnNvbGUubG9nKHN0cik7CiAgICBpZiAobHZsID49IGxvZ2dpbmdMZXZlbHMuYXBwbG9nKSAgTE9HX0FQUEVOREVSLmFwcGVuZChzdHIgKyAiXG4iKTsKfQoKZnVuY3Rpb24gZnFvbihvcmcpIHsKICAgIHJldHVybiBvcmcucHJvcGVydGllcy5mcW9uOwp9CgpmdW5jdGlvbiBmaW5kX2VudGl0bGVtZW50KGVudHMsIGVudGl0bGVtZW50X25hbWUpIHsKICAgIGZvciBlYWNoIChlIGluIGVudHMpIGlmIChlLnByb3BlcnRpZXMuYWN0aW9uID09IGVudGl0bGVtZW50X25hbWUpIHJldHVybiBlOwogICAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGNvbnRhaW5zKGFyciwgdikgewogICAgZm9yIGVhY2ggKGEgaW4gYXJyKSBpZiAoYSA9PSB2KSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gZGlzcChyKSB7CiAgICByZXR1cm4gci5uYW1lICsgIigiICsgci5pZCArICIpIgp9CgovLyB0dXJuIEFycmF5W0Z1dHVyZVtVcGRhdGVzXV0gaW50byBGdXR1cmVbQXJyYXlbVXBkYXRlc11dCmZ1bmN0aW9uIHNlcXVlbmNlKGZ1dHVyZXMpIHsKICAgIHJldHVybiBDb21wbGV0YWJsZUZ1dHVyZS5hbGxPZihmdXR1cmVzKS50aGVuQXBwbHkoZnVuY3Rpb24oZHVtbXlWYXJJc051bGwpewogICAgICAgIHJldHVybiBmdXR1cmVzLm1hcChmdW5jdGlvbihmKXsKICAgICAgICAgICAgcmV0dXJuIGYuam9pbigpOwogICAgICAgIH0pOwogICAgfSk7Cn0KCgpmdW5jdGlvbiBhZGRfZW50aXRsZW1lbnRzKGJhc2Vfb3JnLCByZXNvdXJjZSwgZW50aXRsZW1lbnRfbmFtZXMsIGlkZW50aXR5LCBhc3luYykgewogICAgaWYgKCFBcnJheS5pc0FycmF5KGVudGl0bGVtZW50X25hbWVzKSkgewogICAgICAgIGVudGl0bGVtZW50X25hbWVzID0gW2VudGl0bGVtZW50X25hbWVzXTsKICAgIH0KICAgIHZhciBmRW50VXBkYXRlcyA9IF9HRVQoIi8iICsgZnFvbihiYXNlX29yZykgKyAiL3Jlc291cmNlcy8iICsgcmVzb3VyY2UuaWQgKyAiL2VudGl0bGVtZW50cz9leHBhbmQ9dHJ1ZSIsIERPX0FTWU5DKS50aGVuQ29tcG9zZShmdW5jdGlvbihlbnRzKSB7CiAgICAgICAgcmV0dXJuIHNlcXVlbmNlKGVudGl0bGVtZW50X25hbWVzLm1hcChmdW5jdGlvbihlbmFtZSl7CiAgICAgICAgICAgIHZhciBlbnQgPSBmaW5kX2VudGl0bGVtZW50KGVudHMsIGVuYW1lKTsKICAgICAgICAgICAgaWYgKCFlbnQpIHsKICAgICAgICAgICAgICAgIGxvZygiQ291bGQgbm90IGxvY2F0ZSBlbnRpdGxlbWVudCAiICsgZW5hbWUgKyAiIG9uIHJlc291cmNlICIgKyBkaXNwKHJlc291cmNlKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gQ29tcGxldGFibGVGdXR1cmUuY29tcGxldGVkRnV0dXJlKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjdXJfaWRzID0gZW50LnByb3BlcnRpZXMuaWRlbnRpdGllcy5tYXAoZnVuY3Rpb24oaSkge3JldHVybiBpLmlkO30pOwogICAgICAgICAgICBpZiAoY29udGFpbnMoY3VyX2lkcywgaWRlbnRpdHkuaWQpKSB7CiAgICAgICAgICAgICAgICBsb2coIkVudGl0bGVtZW50ICIgKyByZXNvdXJjZS5uYW1lICsgIlsiICsgZW5hbWUgKyAiXSBhbHJlYWR5IGNvbnRhaW5zIGlkZW50aXR5ICIgKyBkaXNwKGlkZW50aXR5KSk7CiAgICAgICAgICAgICAgICByZXR1cm4gQ29tcGxldGFibGVGdXR1cmUuY29tcGxldGVkRnV0dXJlKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBuZXdfZW50ID0gewogICAgICAgICAgICAgICAgaWQ6IGVudC5pZCwKICAgICAgICAgICAgICAgIG5hbWU6IGVudC5uYW1lLAogICAgICAgICAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZW50LnByb3BlcnRpZXMuYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGlkZW50aXRpZXM6IGN1cl9pZHMuY29uY2F0KGlkZW50aXR5LmlkKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBsb2coIlVwZGF0aW5nIGVudGl0bGVtZW50ICIgKyByZXNvdXJjZS5uYW1lICsgIlsiICsgZW5hbWUgKyAiXSB3aXRoIGlkZW50aXR5ICIgKyBkaXNwKGlkZW50aXR5KSk7CiAgICAgICAgICAgIHN3aXRjaCAocmVzb3VyY2UucmVzb3VyY2VfdHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAiR2VzdGFsdDo6UmVzb3VyY2U6OkVudmlyb25tZW50IjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX1BVVCgiLyIgKyBmcW9uKGJhc2Vfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyByZXNvdXJjZS5pZCArICIvZW50aXRsZW1lbnRzLyIgKyBlbnQuaWQsIG5ld19lbnQsIERPX0FTWU5DKTsKICAgICAgICAgICAgICAgIGNhc2UgIkdlc3RhbHQ6OlJlc291cmNlOjpXb3Jrc3BhY2UiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfUFVUKCIvIiArIGZxb24oYmFzZV9vcmcpICsgIi93b3Jrc3BhY2VzLyIgKyByZXNvdXJjZS5pZCArICIvZW50aXRsZW1lbnRzLyIgKyBlbnQuaWQsIG5ld19lbnQsIERPX0FTWU5DKTsKICAgICAgICAgICAgICAgIGNhc2UgIkdlc3RhbHQ6OlJlc291cmNlOjpPcmdhbml6YXRpb24iOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfUFVUKCIvIiArIGZxb24ocmVzb3VyY2UpICsgIi9lbnRpdGxlbWVudHMvIiArIGVudC5pZCwgbmV3X2VudCwgRE9fQVNZTkMpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX1BVVCgiLyIgKyBmcW9uKGJhc2Vfb3JnKSArICIvZW50aXRsZW1lbnRzLyIgKyBlbnQuaWQsIG5ld19lbnQsIERPX0FTWU5DKTsKICAgICAgICAgICAgfQogICAgICAgIH0pKTsKICAgIH0pOwogICAgdmFyIF9hc3luYyA9IGFzeW5jID8gYXN5bmMgOiBmYWxzZTsgLy8ganVzdCBiZWluZyBleHBsaWNpdCB0aGF0IHRoZSBkZWZhdWx0IGhlcmUgaXMgJ2ZhbHNlJwogICAgaWYgKF9hc3luYykgcmV0dXJuIGZFbnRVcGRhdGVzOwogICAgcmV0dXJuIGZFbnRVcGRhdGVzLmpvaW4oKTsKfQoKZnVuY3Rpb24gY3JlYXRlX21pZ3JhdGVfcG9saWN5KGJhc2Vfb3JnLCBlbnZpcm9ubWVudCwgbGFtYmRhKSB7CiAgICBsb2coImNyZWF0aW5nIG5ldyBtaWdyYXRlIHBvbGljeSBpbiAiICsgZW52aXJvbm1lbnQubmFtZSk7CiAgICB2YXIgcG9sID0gX1BPU1QoIi8iICsgZnFvbihiYXNlX29yZykgKyAiL2Vudmlyb25tZW50cy8iICsgZW52aXJvbm1lbnQuaWQgKyAiL3BvbGljaWVzIiwgewogICAgICAgIG5hbWU6ICJkZWZhdWx0LW1pZ3JhdGUtcG9saWN5IiwKICAgICAgICBkZXNjcmlwdGlvbjogImRlZmF1bHQgY29udGFpbmVyIG1pZ3JhdGlvbiBwb2xpY3kiLAogICAgICAgIHByb3BlcnRpZXM6IHt9CiAgICB9KTsKCiAgICBsb2coImNyZWF0aW5nIG1pZ3JhdGUgZXZlbnQgcnVsZSBpbiBtaWdyYXRlIHBvbGljeSAiICsgcG9sLmlkICsgIiBhZ2FpbnN0IGxhbWJkYSAiICsgbGFtYmRhLmlkKTsKICAgIF9QT1NUKCIvIiArIGZxb24oYmFzZV9vcmcpICsgIi9wb2xpY2llcy8iICsgcG9sLmlkICsgIi9ydWxlcyIsIHsKICAgICAgICBuYW1lOiAibWlncmF0aW9uLWhhbmRsZXIiLAogICAgICAgIGRlc2NyaXB0aW9uOiAiZXhlY3V0ZSBtaWdyYXRlIGxhbWJkYSBvbiBjb250YWluZXIubWlncmF0ZS5wcmUiLAogICAgICAgIHJlc291cmNlX3R5cGU6ICJHZXN0YWx0OjpSZXNvdXJjZTo6UnVsZTo6RXZlbnQiLAogICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgYWN0aW9uczogWyAiY29udGFpbmVyLm1pZ3JhdGUucHJlIiBdLAogICAgICAgICAgICBldmFsX2xvZ2ljOiB7fSwKICAgICAgICAgICAgbGFtYmRhOiBsYW1iZGEuaWQKICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlX3VzZXIocGFyZW50X29yZywgYWNjb3VudF9wYXlsb2FkKSB7CiAgICBsb2coIkNyZWF0aW5nIHVzZXIgIiArIGZxb24ocGFyZW50X29yZykgKyAiLyIgKyBhY2NvdW50X3BheWxvYWQubmFtZSk7CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvdXNlcnMiLCBhY2NvdW50X3BheWxvYWQpOwp9CgpmdW5jdGlvbiBmaW5kX3VzZXIocGFyZW50X29yZywgdXNlcm5hbWUpIHsKICAgIGxvZygiU2VhcmNoaW5nIGZvciB1c2VyICIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi8iICsgdXNlcm5hbWUpOwogICAgdmFyIHVzZXJzID0gX0dFVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi91c2Vycy9zZWFyY2g/dXNlcm5hbWU9IiArIHVzZXJuYW1lKTsKICAgIGZvciBlYWNoICh1c2VyIGluIHVzZXJzKSBpZiAodXNlci5uYW1lID09IHVzZXJuYW1lKSByZXR1cm4gdXNlcjsKICAgIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBkZWxldGVfdXNlcihwYXJlbnRfb3JnLCB1c2VyKSB7CiAgICBsb2coIkRlbGV0aW5nIHVzZXIgIiArIGZxb24ocGFyZW50X29yZykgKyAiLyIgKyBkaXNwKHVzZXIpKTsKICAgIHJldHVybiBfREVMRVRFKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL3VzZXJzLyIgKyB1c2VyLmlkKTsKfQoKZnVuY3Rpb24gY3JlYXRlX2dyb3VwKHBhcmVudF9vcmcsIG5hbWUsIGRlc2MpIHsKICAgIGxvZygiQ3JlYXRpbmcgZ3JvdXAgIiArIHBhcmVudF9vcmcubmFtZSArICIvIiArIG5hbWUpOwogICAgcmV0dXJuIF9QT1NUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2dyb3VwcyIsIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjCiAgICB9KTsKfQoKZnVuY3Rpb24gZmluZF9ncm91cChwYXJlbnRfb3JnLCBncm91cG5hbWUpIHsKICAgIGxvZygiU2VhcmNoaW5nIGZvciBncm91cCAiICsgZnFvbihwYXJlbnRfb3JnKSArICIvIiArIGdyb3VwbmFtZSk7CiAgICB2YXIgZ3JvdXBzID0gX0dFVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9ncm91cHMvc2VhcmNoP25hbWU9IiArIGdyb3VwbmFtZSk7CiAgICBmb3IgZWFjaCAoZ3JvdXAgaW4gZ3JvdXBzKSBpZiAoZ3JvdXAubmFtZSA9PSBncm91cG5hbWUpIHJldHVybiBncm91cDsKICAgIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBkZWxldGVfZ3JvdXAocGFyZW50X29yZywgZ3JvdXApIHsKICAgIGxvZygiRGVsZXRpbmcgZ3JvdXAgIiArIGZxb24ocGFyZW50X29yZykgKyAiLyIgKyBkaXNwKGdyb3VwKSk7CiAgICByZXR1cm4gX0RFTEVURSgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9ncm91cHMvIiArIGdyb3VwLmlkKTsKfQoKZnVuY3Rpb24gYWRkX3VzZXJfdG9fZ3JvdXAocGFyZW50X29yZywgZ3JvdXAsIHVzZXIpIHsKICAgIGxvZygiQWRkaW5nIHVzZXIgIiArIHVzZXIubmFtZSArICIgdG8gZ3JvdXAgIiArIGdyb3VwLm5hbWUpOwogICAgX1BBVENIKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2dyb3Vwcy8iICsgZ3JvdXAuaWQgKyAiL3VzZXJzP2lkPSIgKyB1c2VyLmlkKTsKfQoKLyoKICogcHJvdmlkZXJzCiAqLwoKZnVuY3Rpb24gY3JlYXRlX3Byb3ZpZGVyKHBhcmVudF9vcmcsIHByb3ZpZGVyX3BheWxvYWQpIHsKICAgIGxvZygiQ3JlYXRpbmcgcHJvdmlkZXIgIiArIHByb3ZpZGVyX3BheWxvYWQubmFtZSk7CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvcHJvdmlkZXJzIiwgcHJvdmlkZXJfcGF5bG9hZCk7Cn0KCmZ1bmN0aW9uIGxpc3RfcHJvdmlkZXJzKG9yZywgcHJvdmlkZXJfdHlwZSkgewogICAgdmFyIGVuZHBvaW50ID0gIi8iICsgZnFvbihvcmcpICsgIi9wcm92aWRlcnM/ZXhwYW5kPXRydWUiOwogICAgaWYgKHByb3ZpZGVyX3R5cGUpIGVuZHBvaW50ID0gZW5kcG9pbnQgKyAiJnR5cGU9IiArIHByb3ZpZGVyX3R5cGU7CiAgICByZXR1cm4gX0dFVChlbmRwb2ludCk7Cn0KCmZ1bmN0aW9uIGZpbmRfcHJvdmlkZXIocGFyZW50X29yZywgcHJvdmlkZXJfaWQsIGFzeW5jKSB7CiAgICByZXR1cm4gX0dFVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9wcm92aWRlcnMvIiArIHByb3ZpZGVyX2lkLCBhc3luYyk7Cn0KCmZ1bmN0aW9uIHJlZGVwbG95X3Byb3ZpZGVyKHBhcmVudF9vcmcsIHByb3ZpZGVyLCBhc3luYykgewogICAgbG9nKCJSZWRlcGxveWluZyBwcm92aWRlciAiICsgZGlzcChwcm92aWRlcikpOwogICAgcmV0dXJuIF9QT1NUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL3Byb3ZpZGVycy8iICsgcHJvdmlkZXIuaWQgKyAiL3JlZGVwbG95IiwgbnVsbCwgYXN5bmMpOwp9CgpmdW5jdGlvbiBwYXRjaF9wcm92aWRlcihwYXJlbnRfb3JnLCBwcm92aWRlciwgcGF0Y2gsIGFzeW5jKSB7CiAgICBsb2coIlBhdGNoaW5nIHByb3ZpZGVyICIgKyBkaXNwKHByb3ZpZGVyKSk7CiAgICByZXR1cm4gX1BBVENIKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL3Byb3ZpZGVycy8iICsgcHJvdmlkZXIuaWQsIHBhdGNoLCBhc3luYyk7Cn0KCi8qCiAqIG9yZ3MKICovCgpmdW5jdGlvbiBjcmVhdGVfb3JnKHBhcmVudF9vcmcsIG5hbWUsIGRlc2NyaXB0aW9uLCBhc3luYykgewogICAgbG9nKCJDcmVhdGluZyBvcmcgIiArIHBhcmVudF9vcmcubmFtZSArICIvIiArIG5hbWUpOwogICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLAogICAgICAgIG5hbWU6IG5hbWUKICAgIH07CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSwgcGF5bG9hZCwgYXN5bmMpCn0KCmZ1bmN0aW9uIGZpbmRfb3JnKGZxb24sIGFzeW5jKSB7CiAgICByZXR1cm4gX0dFVCgiLyIgKyBmcW9uLCBhc3luYyk7Cn0KCmZ1bmN0aW9uIGRlbGV0ZV9vcmcob3JnLCBmb3JjZSwgYXN5bmMpIHsKICAgIHZhciBfZm9yY2UgPSBmb3JjZSA/IGZvcmNlIDogZmFsc2U7CiAgICBsb2coIkRlbGV0aW5nIG9yZyAiICsgZnFvbihvcmcpKTsKICAgIHJldHVybiBfREVMRVRFKCIvIiArIGZxb24ob3JnKSArICI/Zm9yY2U9IiArIF9mb3JjZSwgYXN5bmMpOwp9CgovKgogKiBlbnZpcm9ubWVudHMKICovCgpmdW5jdGlvbiBjcmVhdGVfZW52aXJvbm1lbnQocGFyZW50X29yZywgcGFyZW50X3dvcmtzcGFjZSwgbmFtZSwgZGVzY3JpcHRpb24sIHR5cGUsIGFzeW5jLCBmKSB7CiAgICBsb2coIkNyZWF0aW5nIGVudmlyb25tZW50ICIgKyBwYXJlbnRfd29ya3NwYWNlLm5hbWUgKyAiLyIgKyBuYW1lKTsKICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgZW52aXJvbm1lbnRfdHlwZTogdHlwZQogICAgICAgIH0KICAgIH07CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvd29ya3NwYWNlcy8iICsgcGFyZW50X3dvcmtzcGFjZS5pZCArICIvZW52aXJvbm1lbnRzIiwgcGF5bG9hZCwgYXN5bmMsIGYpOwp9CgpmdW5jdGlvbiBmaW5kX2Vudmlyb25tZW50KHBhcmVudF9vcmcsIGVudmlyb25tZW50X2lkLCBhc3luYykgewogICAgcmV0dXJuIF9HRVQoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBlbnZpcm9ubWVudF9pZCwgYXN5bmMpOwp9CgovKgogKiB3b3Jrc3BhY2VzCiAqLwoKZnVuY3Rpb24gY3JlYXRlX3dvcmtzcGFjZShwYXJlbnRfb3JnLCBuYW1lLCBkZXNjcmlwdGlvbiwgYXN5bmMsIGYpIHsKICAgIGxvZygiQ3JlYXRpbmcgd29ya3NwYWNlICIgKyBwYXJlbnRfb3JnLm5hbWUgKyAiLyIgKyBuYW1lKTsKICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwKICAgICAgICBuYW1lOiBuYW1lCiAgICB9OwogICAgcmV0dXJuIF9QT1NUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL3dvcmtzcGFjZXMiLCBwYXlsb2FkLCBhc3luYywgZik7Cn0KCi8qCiAqIGxhbWJkYXMKICovCgpmdW5jdGlvbiBjcmVhdGVfbGFtYmRhKHBhcmVudF9vcmcsIHBhcmVudF9lbnYsIGxhbWJkYV9wYXlsb2FkKSB7CiAgICBsb2coIkNyZWF0aW5nIGxhbWJkYSAiICsgcGFyZW50X2Vudi5uYW1lICsgIi8iICsgbGFtYmRhX3BheWxvYWQubmFtZSk7CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBwYXJlbnRfZW52LmlkICsgIi9sYW1iZGFzIiwgbGFtYmRhX3BheWxvYWQpOwp9CgovKgogKiBjb250YWluZXJzCiAqLwoKZnVuY3Rpb24gY3JlYXRlX2NvbnRhaW5lcihwYXJlbnRfb3JnLCBwYXJlbnRfZW52LCBwYXlsb2FkLCBhc3luYykgewogICAgbG9nKCJDcmVhdGluZyBjb250YWluZXIgIiArIHBheWxvYWQubmFtZSArICIgaW4gIiArIGZxb24ocGFyZW50X29yZykgKyAiL2Vudmlyb25tZW50cy8iICsgcGFyZW50X2Vudi5pZCk7CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBwYXJlbnRfZW52LmlkICsgIi9jb250YWluZXJzIiwgcGF5bG9hZCwgYXN5bmMpOwp9CgpmdW5jdGlvbiBmaW5kX2NvbnRhaW5lcl9ieV9uYW1lKHBhcmVudF9vcmcsIHBhcmVudF9lbnYsIG5hbWUpIHsKICAgIHZhciBlbmRwb2ludCA9ICIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2Vudmlyb25tZW50cy8iICsgcGFyZW50X2Vudi5pZCArICIvY29udGFpbmVycz9leHBhbmQ9dHJ1ZSI7CiAgICB2YXIgY29udGFpbmVycyA9IF9HRVQoZW5kcG9pbnQpOwogICAgZm9yIGVhY2ggKGMgaW4gY29udGFpbmVycykgaWYgKGMubmFtZSA9PSBuYW1lKSByZXR1cm4gYzsKICAgIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBkZWxldGVfY29udGFpbmVyKHBhcmVudF9vcmcsIHBhcmVudF9lbnYsIGNvbnRhaW5lciwgYXN5bmMsIGZvcmNlKSB7CiAgICBfZm9yY2UgPSBmb3JjZSA/IGZvcmNlIDogZmFsc2U7CiAgICBsb2coIkRlbGV0aW5nIGNvbnRhaW5lciAiICsgZGlzcChjb250YWluZXIpICsgIiBmcm9tICIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIHBhcmVudF9lbnYuaWQpOwogICAgcmV0dXJuIF9ERUxFVEUoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBwYXJlbnRfZW52LmlkICsgIi9jb250YWluZXJzLyIgKyBjb250YWluZXIuaWQgKyAiP2ZvcmNlPSIgKyBfZm9yY2UsYXN5bmMpOwp9CgpmdW5jdGlvbiBwYXRjaF9jb250YWluZXIocGFyZW50X29yZywgcGFyZW50X2VudiwgY29udGFpbmVyLCBwYXRjaCwgYXN5bmMpIHsKICAgIGxvZygiUGF0Y2hpbmcgY29udGFpbmVyICIgKyBkaXNwKGNvbnRhaW5lcikpOwogICAgcmV0dXJuIF9QQVRDSCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIHBhcmVudF9lbnYuaWQgKyAiL2NvbnRhaW5lcnMvIiArIGNvbnRhaW5lci5pZCwgcGF0Y2gsIGFzeW5jKTsKfQoKZnVuY3Rpb24gdXBkYXRlX2NvbnRhaW5lcihwYXJlbnRfb3JnLCBjb250YWluZXIsIGFzeW5jKSB7CiAgICBsb2coIlVwZGF0aW5nIGNvbnRhaW5lciAiICsgZGlzcChjb250YWluZXIpKTsKICAgIHJldHVybiBfUFVUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2NvbnRhaW5lcnMvIiArIGNvbnRhaW5lci5pZCwgY29udGFpbmVyLCBhc3luYyk7Cn0KCi8qCiAqIGFwaXMKICovCgpmdW5jdGlvbiBjcmVhdGVfYXBpKHBhcmVudF9vcmcsIHBhcmVudF9lbnYsIHBheWxvYWQsIGFzeW5jKSB7CiAgICBsb2coIkNyZWF0aW5nIGFwaSAiICsgcGF5bG9hZC5uYW1lICsgIiBpbiAiICsgZnFvbihwYXJlbnRfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBwYXJlbnRfZW52LmlkKTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIHBhcmVudF9lbnYuaWQgKyAiL2FwaXMiLCBwYXlsb2FkLCBhc3luYyk7Cn0KCmZ1bmN0aW9uIGZpbmRfYXBpKHBhcmVudF9vcmcsIGFwaV9pZCwgYXN5bmMpIHsKICAgIHJldHVybiBfR0VUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2FwaXMvIiArIGFwaV9pZCwgYXN5bmMpOwp9CgovKgogKiBhcGllbmRwb2ludHMKICovCgpmdW5jdGlvbiBjcmVhdGVfYXBpZW5kcG9pbnQocGFyZW50X29yZywgcGFyZW50X2FwaSwgcGF5bG9hZCwgYXN5bmMpIHsKICAgIGxvZygiQ3JlYXRpbmcgYXBpZW5kcG9pbnQgIiArIHBheWxvYWQubmFtZSArICIgaW4gIiArIGZxb24ocGFyZW50X29yZykgKyAiL2FwaXMvIiArIHBhcmVudF9hcGkuaWQpOwogICAgcmV0dXJuIF9QT1NUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2FwaXMvIiArIHBhcmVudF9hcGkuaWQgKyAiL2FwaWVuZHBvaW50cyIsIHBheWxvYWQsIGFzeW5jKTsKfQoKZnVuY3Rpb24gbGlzdF9jb250YWluZXJfYXBpZW5kcG9pbnRzKG9yZywgY29udGFpbmVyKSB7CiAgICB2YXIgZW5kcG9pbnQgPSAiLyIgKyBmcW9uKG9yZykgKyAiL2FwaWVuZHBvaW50cz9leHBhbmQ9dHJ1ZSZpbXBsZW1lbnRhdGlvbl90eXBlPWNvbnRhaW5lciZpbXBsZW1lbnRhdGlvbl9pZD0iICsgY29udGFpbmVyLmlkOwogICAgcmV0dXJuIF9HRVQoZW5kcG9pbnQpOwp9CgpmdW5jdGlvbiBsaXN0X2xhbWJkYV9hcGllbmRwb2ludHMob3JnLCBsYW1iZGEpIHsKICAgIHZhciBlbmRwb2ludCA9ICIvIiArIGZxb24ob3JnKSArICIvYXBpZW5kcG9pbnRzP2V4cGFuZD10cnVlJmltcGxlbWVudGF0aW9uX3R5cGU9bGFtYmRhJmltcGxlbWVudGF0aW9uX2lkPSIgKyBsYW1iZGEuaWQ7CiAgICByZXR1cm4gX0dFVChlbmRwb2ludCk7Cn0KCmZ1bmN0aW9uIGRlbGV0ZV9lbmRwb2ludChwYXJlbnRfb3JnLCBlbmRwb2ludCwgYXN5bmMpIHsKICAgIGxvZygiRGVsZXRpbmcgZW5kcG9pbnQgIiArIGRpc3AoZW5kcG9pbnQpICsgIiBmcm9tICIgKyBmcW9uKHBhcmVudF9vcmcpKTsKICAgIHJldHVybiBfREVMRVRFKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2FwaWVuZHBvaW50cy8iICsgZW5kcG9pbnQuaWQsIGFzeW5jKTsKfQoKZnVuY3Rpb24gdXBkYXRlX2VuZHBvaW50X3RhcmdldChvcmcsIGVuZHBvaW50LCBuZXdfdGFyZ2V0KSB7CiAgICB2YXIgcGF0Y2ggPSBbewogICAgICAgIG9wOiAicmVwbGFjZSIsCiAgICAgICAgcGF0aDogIi9wcm9wZXJ0aWVzL2ltcGxlbWVudGF0aW9uX2lkIiwKICAgICAgICB2YWx1ZTogbmV3X3RhcmdldC5pZAogICAgfV07CiAgICBsb2coSlNPTi5zdHJpbmdpZnkocGF0Y2gpKTsKICAgIHZhciB1cmwgPSAiLyIgKyBmcW9uKG9yZykgKyAiL2FwaWVuZHBvaW50cy8iICsgZW5kcG9pbnQuaWQ7CiAgICByZXR1cm4gX1BBVENIKHVybCwgcGF0Y2gpOwp9CgpmdW5jdGlvbiBmaW5kX2VuZG9pbnRfYnlfbmFtZShwYXJlbnRfb3JnLCBwYXJlbnRfYXBpLCBuYW1lKSB7CiAgICB2YXIgZW5kcG9pbnQgPSAiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9hcGlzLyIgKyBwYXJlbnRfYXBpLmlkICsgIi9hcGllbmRwb2ludHM/ZXhwYW5kPXRydWUiOwogICAgdmFyIGVwcyA9IF9HRVQoZW5kcG9pbnQpOwogICAgZm9yIGVhY2ggKGVwIGluIGVwcykgaWYgKGVwLm5hbWUgPT0gbmFtZSkgcmV0dXJuIGVwOwogICAgcmV0dXJuIG51bGw7Cn0KCi8qCiAqIHBvbGljeQogKi8KCmZ1bmN0aW9uIGNyZWF0ZV9wb2xpY3koYmFzZV9vcmcsIGVudmlyb25tZW50LCBuYW1lLCBkZXNjcmlwdGlvbikgewogICAgbG9nKCJjcmVhdGluZyBuZXcgcG9saWN5IGluICIgKyBlbnZpcm9ubWVudC5uYW1lKTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKGJhc2Vfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBlbnZpcm9ubWVudC5pZCArICIvcG9saWNpZXMiLCB7CiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gPyBkZXNjcmlwdGlvbiA6ICIiLAogICAgICAgIHByb3BlcnRpZXM6IHt9CiAgICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlX2V2ZW50X3J1bGUoYmFzZV9vcmcsIHBvbGljeSwgbmFtZSwgZGVzY3JpcHRpb24sIGxhbWJkYUlkLCBtYXRjaF9hY3Rpb25zKSB7CiAgICBsb2coImNyZWF0aW5nIG5ldyBldmVudCBydWxlIGluICIgKyBwb2xpY3kubmFtZSk7CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihiYXNlX29yZykgKyAiL3BvbGljaWVzLyIgKyBwb2xpY3kuaWQgKyAiL3J1bGVzIiwgewogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uID8gZGVzY3JpcHRpb24gOiAiIiwKICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgIHBhcmVudDoge30sCiAgICAgICAgICAgIGxhbWJkYTogbGFtYmRhSWQsCiAgICAgICAgICAgIG1hdGNoX2FjdGlvbnM6IG1hdGNoX2FjdGlvbnMKICAgICAgICB9LAogICAgICAgIHJlc291cmNlX3R5cGU6ICJHZXN0YWx0OjpSZXNvdXJjZTo6UnVsZTo6RXZlbnQiCiAgICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlX2xpbWl0X3J1bGUoYmFzZV9vcmcsIHBvbGljeSwgbmFtZSwgZGVzY3JpcHRpb24sIG1hdGNoX2FjdGlvbnMsIHByb3BlcnR5LCBvcGVyYXRvciwgdmFsdWUpIHsKICAgIGxvZygiY3JlYXRpbmcgbmV3IGxpbWl0IHJ1bGUgaW4gIiArIHBvbGljeS5uYW1lKTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKGJhc2Vfb3JnKSArICIvcG9saWNpZXMvIiArIHBvbGljeS5pZCArICIvcnVsZXMiLHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiA/IGRlc2NyaXB0aW9uIDogIiIsCiAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICBwYXJlbnQ6IHt9LAogICAgICAgICAgICBzdHJpY3Q6IGZhbHNlLAogICAgICAgICAgICBtYXRjaF9hY3Rpb25zOiBtYXRjaF9hY3Rpb25zLAogICAgICAgICAgICBldmFsX2xvZ2ljOiB7CiAgICAgICAgICAgICAgICBwcm9wZXJ0eTogcHJvcGVydHksCiAgICAgICAgICAgICAgICBvcGVyYXRvcjogb3BlcmF0b3IsCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVzb3VyY2VfdHlwZTogIkdlc3RhbHQ6OlJlc291cmNlOjpSdWxlOjpMaW1pdCIKICAgIH0pOwp9CgovKgogKiBSZXNvdXJjZVR5cGVzIGFuZCBQcm9wZXJ0eURlZmluaXRpb25zCiAqLwoKZnVuY3Rpb24gZ2V0X3Jlc291cmNldHlwZV9ieV9pZChiYXNlX29yZywgaWQpIHsKICAgIGxvZygiZ2V0dGluZyByZXNvdXJjZSB0eXBlIHdpdGggaWQgIiArIGlkKTsKICAgIHZhciBlbmRwb2ludCA9ICIvIiArIGZxb24oYmFzZV9vcmcpICsgIi9yZXNvdXJjZXR5cGVzLyIgKyBpZCArICI/d2l0aHByb3BzPXRydWUiOwogICAgcmV0dXJuIF9HRVQoZW5kcG9pbnQpOwp9CgoKLyoKICogUkVTVCB1dGlsaXRpZXMKICovCgpmdW5jdGlvbiBfaGFuZGxlUmVzcG9uc2UocmVzcG9uc2UpIHsKICAgIHZhciBjb2RlID0gcmVzcG9uc2UuZ2V0U3RhdHVzQ29kZSgpOwogICAgdmFyIGJvZHkgPSByZXNwb25zZS5nZXRSZXNwb25zZUJvZHkoKTsKICAgIGlmIChjb2RlID09IDQwNCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfSBlbHNlIGlmIChjb2RlID49IDMwMCkgewogICAgICAgIGxvZygiV0FSTklORzogc3RhdHVzIGNvZGUgIiArIGNvZGUgKyAiIGZyb20gIiArIHJlc3BvbnNlLmdldFVyaSgpKTsKICAgICAgICBsb2coInJlc3BvbnNlOiAiICsgYm9keSk7CiAgICAgICAgdGhyb3cgY29kZTsKICAgIH0gZWxzZSBpZiAoY29kZSA9PSAyMDQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChyZXNwb25zZS5nZXRDb250ZW50VHlwZSgpICYmIHJlc3BvbnNlLmdldENvbnRlbnRUeXBlKCkuc3RhcnRzV2l0aCgiYXBwbGljYXRpb24vanNvbiIpKSByZXR1cm4gSlNPTi5wYXJzZShib2R5KTsKICAgIHJldHVybiBib2R5Owp9CgpmdW5jdGlvbiBfUkVTVF9KU09OKG1ldGhvZCwgZW5kcG9pbnQsIHBheWxvYWQsIGFzeW5jLCBmUmVzcG9uc2UpIHsKICAgIHZhciB1cmwgPSBNRVRBLnVybCArIGVuZHBvaW50OwogICAgdmFyIHBjID0gY2xpZW50LnByZXBhcmVDb25uZWN0KHVybCkKICAgICAgICAuc2V0TWV0aG9kKG1ldGhvZCkKICAgICAgICAuYWRkSGVhZGVyKCJBdXRob3JpemF0aW9uIiwgTUVUQS5jcmVkcyk7CiAgICBsb2cobWV0aG9kICsgIiAiICsgdXJsLCBMb2dnaW5nTGV2ZWxzLkRFQlVHKTsKICAgIGlmIChwYXlsb2FkKSB7CiAgICAgICAgcGMgPSBwYy5zZXRCb2R5KEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKS5hZGRIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uIikKICAgIH0KICAgIHZhciBfYXN5bmMgPSBhc3luYyA/IGFzeW5jIDogZmFsc2U7IC8vIGp1c3QgYmVpbmcgZXhwbGljaXQgdGhhdCB0aGUgZGVmYXVsdCBoZXJlIGlzICdmYWxzZScKICAgIGlmIChfYXN5bmMpIHsKICAgICAgICBpZiAoIWZSZXNwb25zZSkgZlJlc3BvbnNlID0gbmV3IENvbXBsZXRhYmxlRnV0dXJlKCk7CiAgICAgICAgcGMuZXhlY3V0ZShuZXcgb3JnLmFzeW5jaHR0cGNsaWVudC5Bc3luY0NvbXBsZXRpb25IYW5kbGVyKHsKICAgICAgICAgICAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBmUmVzcG9uc2UuY29tcGxldGUoX2hhbmRsZVJlc3BvbnNlKHJlc3BvbnNlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgICAgcmV0dXJuIGZSZXNwb25zZTsKICAgIH0KICAgIHJldHVybiBfaGFuZGxlUmVzcG9uc2UocGMuZXhlY3V0ZSgpLmdldCgpKTsKfQoKZnVuY3Rpb24gX0RFTEVURShlbmRwb2ludCwgYXN5bmMsIGZSZXNwb25zZSkgewogICAgcmV0dXJuIF9SRVNUX0pTT04oIkRFTEVURSIsIGVuZHBvaW50LCBudWxsLCBhc3luYywgZlJlc3BvbnNlKTsKfQoKZnVuY3Rpb24gX0dFVChlbmRwb2ludCwgYXN5bmMsIGZSZXNwb25zZSkgewogICAgcmV0dXJuIF9SRVNUX0pTT04oIkdFVCIsIGVuZHBvaW50LCBudWxsLCBhc3luYywgZlJlc3BvbnNlKTsKfQoKZnVuY3Rpb24gX1BPU1QoZW5kcG9pbnQsIHBheWxvYWQsIGFzeW5jLCBmUmVzcG9uc2UpIHsKICAgIHJldHVybiBfUkVTVF9KU09OKCJQT1NUIiwgZW5kcG9pbnQsIHBheWxvYWQsIGFzeW5jLCBmUmVzcG9uc2UpOwp9CgpmdW5jdGlvbiBfUFVUKGVuZHBvaW50LCBwYXlsb2FkLCBhc3luYywgZlJlc3BvbnNlKSB7CiAgICByZXR1cm4gX1JFU1RfSlNPTigiUFVUIiwgZW5kcG9pbnQsIHBheWxvYWQsIGFzeW5jLCBmUmVzcG9uc2UpOwp9CgpmdW5jdGlvbiBfUEFUQ0goZW5kcG9pbnQsIHBheWxvYWQsIGFzeW5jLCBmUmVzcG9uc2UpIHsKICAgIHJldHVybiBfUkVTVF9KU09OKCJQQVRDSCIsIGVuZHBvaW50LCBwYXlsb2FkLCBhc3luYywgZlJlc3BvbnNlKTsKfQo=",
        "code_type": "code",
        "cpus": 0.1,
        "memory": 128,
        "timeout": 60,
        "pre_warm": 0,
        "handler": "promote",
        "public": true,
        "runtime": "nashorn",
        "provider": {
            "id": "#{Provider /root/default-laser id}",
            "locations": []
        },
        "periodic_info": {},
        "secrets": [],
        "apiendpoints": []
    }
}
