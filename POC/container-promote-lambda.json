{
    "resource_type": "Gestalt::Resource::Node::Lambda",
    "name": "container-promote",
    "description": "Container Migration Lambda",
    "properties": {
        "env": {
            "META_URL": "http://gestalt-meta.gestalt-system:10131",
            "API_KEY": "15c0bcd4-641e-4807-97f0-16e8afa40858",
            "API_SECRET": "m6g3BMz3jKrk7SMnp0rEPgKh2k04VNy9Ured/N3E"
        },
        "headers": {
            "Accept": "text/plain",
            "Content-Type": "text/plain"
        },
        "code": "ZnVuY3Rpb24gcHJvbW90ZShhcmdzLCBjdHgpIHsKICAgIGxvZygiKioqKiogYmVnaW4gcHJvbW90ZSAqKioqKioqKioqKioiKTsKCiAgICBhcmdzID0gSlNPTi5wYXJzZSggYXJncyApOwogICAgY3R4ICA9IEpTT04ucGFyc2UoIGN0eCApOwoKICAgIE1FVEEgPSBnZXRfbWV0YShhcmdzLCBjdHguY3JlZHMpOwogICAgbG9nKCJbaW5pdF0gZm91bmQgbWV0YTogIiArIE1FVEEudXJsKTsKCiAgICB2YXIgdGd0X2Vudl9pZCA9IGFyZ3MudGFyZ2V0X2Vudl9pZDsKICAgIHZhciBjdXJfZW52X2lkID0gYXJncy5lbnZpcm9ubWVudF9pZDsKCiAgICB2YXIgY3VyX2FwcCAgICA9IGFyZ3MucmVzb3VyY2U7CgogICAgdmFyIHBhcmVudF9vcmcgPSBmaW5kX29yZyhhcmdzLmZxb24pOwoKICAgIHZhciBjdXJfZW52ID0gZmluZF9lbnZpcm9ubWVudChwYXJlbnRfb3JnLCBjdXJfZW52X2lkKTsKICAgIHZhciB0Z3RfZW52ID0gZmluZF9lbnZpcm9ubWVudChwYXJlbnRfb3JnLCB0Z3RfZW52X2lkKTsKCiAgICBsb2coInJlcXVlc3QgdG8gcHJvbW90ZSBjb250YWluZXIgIiArIGN1cl9hcHAubmFtZSArICIgZnJvbSAiICsgY3VyX2Vudi5uYW1lICsgIiB0byBlbnZpcm9ubWVudCAiICsgdGd0X2Vudi5uYW1lKTsKCiAgICB2YXIgdGd0X2FwcCA9IGZpbmRfY29udGFpbmVyX2J5X25hbWUocGFyZW50X29yZywgdGd0X2VudiwgY3VyX2FwcC5uYW1lKTsKICAgIGlmICggISB0Z3RfYXBwICkgewogICAgICAgIC8vIGxvZygiRVJST1I6IGNvdWxkIG5vdCBsb2NhdGUgdGFyZ2V0IGNvbnRhaW5lciBpbiBlbnZpcm9ubWVudCAiICsgdGd0X2Vudi5uYW1lICsgIiB3aXRoIG5hbWUgIiArIGN1cl9hcHAubmFtZSk7CiAgICAgICAgLy8gcmV0dXJuIGdldExvZygpOwoKICAgICAgICB2YXIgbmV3X2FwcDsKICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgb3AgPSBjdXJfYXBwLnByb3BlcnRpZXM7CiAgICAgICAgICAgIHZhciBjdXJfbnVtX2luc3RhbmNlcyA9IEpTT04ucGFyc2Uob3AubnVtX2luc3RhbmNlcyk7CiAgICAgICAgICAgIG5ld19hcHAgPSBjcmVhdGVfY29udGFpbmVyKHBhcmVudF9vcmcsIHRndF9lbnYsIHsKICAgICAgICAgICAgICAgIG5hbWU6ICAgICAgICBjdXJfYXBwLm5hbWUsCiAgICAgICAgICAgICAgICAvLyBkZXNjcmlwdGlvbjogY3VyX2FwcC5kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiUHJvbW90ZWQgYXQgIiArIFN0cmluZyhEYXRlKCkpLAogICAgICAgICAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBvcC5wcm92aWRlci5pZAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbnVtX2luc3RhbmNlczogIGN1cl9udW1faW5zdGFuY2VzID4gMCA/IGN1cl9udW1faW5zdGFuY2VzIDogMSwKICAgICAgICAgICAgICAgICAgICBjcHVzOiAgICAgICAgICAgb3AuY3B1cywKICAgICAgICAgICAgICAgICAgICBtZW1vcnk6ICAgICAgICAgb3AubWVtb3J5LAogICAgICAgICAgICAgICAgICAgIGRpc2s6ICAgICAgICAgICBvcC5kaXNrLAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcl90eXBlOiBvcC5jb250YWluZXJfdHlwZSwKICAgICAgICAgICAgICAgICAgICBpbWFnZTogICAgICAgICAgb3AuaW1hZ2UsCiAgICAgICAgICAgICAgICAgICAgbmV0d29yazogICAgICAgIG9wLm5ldHdvcmssCiAgICAgICAgICAgICAgICAgICAgaGVhbHRoX2NoZWNrczogIG9wLmhlYWx0aF9jaGVja3MgPyBvcC5oZWFsdGhfY2hlY2tzIDogW10sCiAgICAgICAgICAgICAgICAgICAgcG9ydF9tYXBwaW5nczogIG9wLnBvcnRfbWFwcGluZ3MgPyBvcC5wb3J0X21hcHBpbmdzIDogW10sCiAgICAgICAgICAgICAgICAgICAgbGFiZWxzOiAgICAgICAgIG9wLmxhYmVscyAgICAgICAgPyBvcC5sYWJlbHMgICAgICAgIDoge30sCiAgICAgICAgICAgICAgICAgICAgZW52OiAgICAgICAgICAgIG9wLmVudiAgICAgICAgICAgPyBvcC5lbnYgICAgICAgICAgIDoge30sCiAgICAgICAgICAgICAgICAgICAgdm9sdW1lcyA6ICAgICAgIG9wLnZvbHVtZXMgICAgICAgPyBvcC52b2x1bWVzICAgICAgIDogW10sCiAgICAgICAgICAgICAgICAgICAgZm9yY2VfcHVsbCA6ICAgIG9wLmZvcmNlX3B1bGwgICAgPyBvcC5mb3JjZV9wdWxsICAgIDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludHMgOiAgIG9wLmNvbnN0cmFpbnRzICAgPyBvcC5jb25zdHJhaW50cyAgIDogW10sCiAgICAgICAgICAgICAgICAgICAgYWNjZXB0ZWRfcmVzb3VyY2Vfcm9sZXM6IG9wLmFjY2VwdGVkX3Jlc291cmNlX3JvbGVzID8gb3AuYWNjZXB0ZWRfcmVzb3VyY2Vfcm9sZXMgOiBbXSwKICAgICAgICAgICAgICAgICAgICBhcmdzIDogICAgICAgICAgb3AuYXJncywKICAgICAgICAgICAgICAgICAgICBjbWQ6ICAgICAgICAgICAgb3AuY21kLAogICAgICAgICAgICAgICAgICAgIHVzZXI6ICAgICAgICAgICBvcC51c2VyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2goZXJyKSB7CiAgICAgICAgICAgIGxvZygiRVJST1I6IGVycm9yIGNyZWF0aW5nIGNvbnRhaW5lcjogcmVzcG9uc2UgY29kZSAiICsgZXJyKTsKICAgICAgICAgICAgcmV0dXJuIGdldExvZygpOwogICAgICAgIH0KICAgICAgICBsb2coIkNyZWF0ZWQgbmV3IGNvbnRhaW5lciB3aXRoIGlkICIgKyBuZXdfYXBwLmlkKTsKICAgICAgICByZXR1cm4gZ2V0TG9nKCk7CiAgICB9CgogICAgLy8gT3RoZXJ3aXNlLCBtb2RpZnkgdGhlIGV4aXN0aW5nIGNvbnRhaW5lcgoKICAgIGxvZygibG9jYXRlZCB0YXJnZXQgYXBwICIgKyBkaXNwKHRndF9hcHApICk7CgogICAgdHJ5IHsKICAgICAgICBwYXRjaF9jb250YWluZXIocGFyZW50X29yZywgdGd0X2VudiwgdGd0X2FwcCwgWwogICAgICAgICAgICByZXBsYWNlKCJpbWFnZSIsIGN1cl9hcHAucHJvcGVydGllcy5pbWFnZSksCiAgICAgICAgICAgIHJlcGxhY2UoImVudiIsICAgY3VyX2FwcC5wcm9wZXJ0aWVzLmVudikKICAgICAgICBdKTsKICAgIH0gY2F0Y2goZXJyKSB7CiAgICAgICAgbG9nKCJFUlJPUjogZXJyb3IgY3JlYXRpbmcgY29udGFpbmVyOiByZXNwb25zZSBjb2RlICIgKyBlcnIpOwogICAgICAgIHJldHVybiBnZXRMb2coKTsKICAgIH0KICAgIGxvZygiQ29udGFpbmVyIHN1Y2Nlc3NmdWxseSBtaWdyYXRlZC4iKTsKCiAgICBsb2coIioqKioqIGVuZCBwcm9tb3RlICoqKioqKioqKioqKioqIik7CiAgICByZXR1cm4gIkNvbnRhaW5lciBtaWdyYXRlZC4iOwp9CgpmdW5jdGlvbiByZXBsYWNlKHByb3BfcGF0aCwgdmFsdWUpIHsKICAgIHJldHVybiB7CiAgICAgICAgb3A6ICJyZXBsYWNlIiwKICAgICAgICBwYXRoOiAiL3Byb3BlcnRpZXMvIiArIHByb3BfcGF0aCwKICAgICAgICB2YWx1ZTogdmFsdWUKICAgIH0KfQoKCgovLyAtLS0tLS0tLS0tLS0tLS0tLSBTREsgZnVuY3Rpb25zIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKCnZhciBBc3luY0h0dHBDbGllbnQgICA9IEphdmEudHlwZSgnb3JnLmFzeW5jaHR0cGNsaWVudC5EZWZhdWx0QXN5bmNIdHRwQ2xpZW50Jyk7CnZhciBDb21wbGV0YWJsZUZ1dHVyZSA9IEphdmEudHlwZSgnamF2YS51dGlsLmNvbmN1cnJlbnQuQ29tcGxldGFibGVGdXR1cmUnKTsKCnZhciBNRVRBICAgPSBudWxsOwp2YXIgTE9HX0FQUEVOREVSID0gbmV3IGphdmEubGFuZy5TdHJpbmdCdWZmZXIoKTsKdmFyIGNsaWVudCA9IG5ldyBBc3luY0h0dHBDbGllbnQoKTsKCnZhciBFbnZpcm9ubWVudFR5cGVzID0gewogICAgREVWRUxPUE1FTlQ6ICJkZXZlbG9wbWVudCIsCiAgICBQUk9EVUNUSU9OOiAicHJvZHVjdGlvbiIsCiAgICBURVNUOiAidGVzdCIKfTsKCnZhciBQcm92aWRlclR5cGVzID0gewogICAgLy8gZm9yIHNlYXJjaAogICAgR0FURVdBWU1BTkFHRVI6ICJHYXRld2F5TWFuYWdlciIsCiAgICBLT05HOiAiS29uZyIsCiAgICBDQUFTOiAiQ2FhUyIsCiAgICBMQU1CREE6ICJMYW1iZGEiLAogICAgLy8gZm9yIGNyZWF0ZQogICAgRENPUzogIkdlc3RhbHQ6OkNvbmZpZ3VyYXRpb246OlByb3ZpZGVyOjpDYWFTOjpEQ09TIiwKICAgIEtVQkU6ICJHZXN0YWx0OjpDb25maWd1cmF0aW9uOjpQcm92aWRlcjo6Q2FhUzo6S3ViZXJuZXRlcyIKfTsKCnZhciBGT1JDRV9ERUxFVEUgPSB0cnVlOwp2YXIgRE9fQVNZTkMgPSB0cnVlOwoKdmFyIExvZ2dpbmdMZXZlbHMgPSB7CiAgICBFUlJPUjogMywKICAgIFdBUk5JTkc6IDIsCiAgICBJTkZPOiAxLAogICAgREVCVUc6IDAKfTsKCmZ1bmN0aW9uIGdldEFwcExvZ0xldmVsKCkgewogICAgaWYgKGdldF9lbnYoIkxPR19ERUJVRyIsICJmYWxzZSIpID09ICJ0cnVlIikgewogICAgICAgIGNvbnNvbGUubG9nKCJlbmFibGluZyBkZWJ1ZyBsb2dnaW5nIik7CiAgICAgICAgTE9HX0FQUEVOREVSLmFwcGVuZCgiZW5hYmxpbmcgZGVidWcgbG9nZ2luZ1xuIik7CiAgICAgICAgcmV0dXJuIExvZ2dpbmdMZXZlbHMuREVCVUc7CiAgICB9CiAgICByZXR1cm4gTG9nZ2luZ0xldmVscy5JTkZPOwp9Cgp2YXIgbG9nZ2luZ0xldmVscyA9IHsKICAgIGFwcGxvZzogIGdldEFwcExvZ0xldmVsKCksCiAgICBjb25zb2xlOiBMb2dnaW5nTGV2ZWxzLkRFQlVHCn07CgpmdW5jdGlvbiBnZXRfZW52KGtleSxkZWYpIHsKICAgIHZhciB2YWwgPSBqYXZhLmxhbmcuU3lzdGVtLmdldGVudigpLmdldChrZXkpOwogICAgaWYgKHZhbCkgcmV0dXJuIHZhbDsKICAgIGlmIChkZWYpIHJldHVybiBkZWY7CiAgICB0aHJvdyAiRW52IG1pc3NpbmcgdmFyaWFibGUgIiArIGtleTsKfQoKZnVuY3Rpb24gZ2V0X21ldGEoYXJncywgYykgewogICAgbG9nKGMsIExvZ2dpbmdMZXZlbHMuREVCVUcpOwogICAgbG9nKGFyZ3MsIExvZ2dpbmdMZXZlbHMuREVCVUcpOwogICAgaWYgKGFyZ3MgJiYgYXJncy5tZXRhX3VybCkgewogICAgICAgIHZhciBtZXRhX3VybCA9IGFyZ3MubWV0YV91cmw7CiAgICB9IGVsc2UgewogICAgICAgIHZhciBtZXRhX3VybCA9IGdldF9lbnYoIk1FVEFfVVJMIik7CiAgICB9CgogICAgdmFyIGN0eCA9IG51bGw7CiAgICB2YXIgY3JlZHMgPSBudWxsOwogICAgaWYgKHR5cGVvZihjKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICBsb2coImdldF9tZXRhOiByZWN2ZCBjb250ZXh0IiwgTG9nZ2luZ0xldmVscy5ERUJVRyk7CiAgICAgICAgY3R4ID0gYzsKICAgIH0gZWxzZSBpZiAodHlwZW9mKGMpID09PSAnc3RyaW5nJykgewogICAgICAgIGxvZygiZ2V0X21ldGE6IHJlY3ZkIGNyZWRzIiwgTG9nZ2luZ0xldmVscy5ERUJVRyk7CiAgICAgICAgY3JlZHMgPSBjOwogICAgfQoKICAgIGlmICghY3JlZHMgfHwgY3JlZHMgPT09ICIiKSB7CiAgICAgICAgbG9nKCJnZXRfbWV0YTogY3JlZHMgYWJzZW50LCBleGFtaW5pbmcgY29udGV4dCIsIExvZ2dpbmdMZXZlbHMuREVCVUcpOwogICAgICAgIGlmIChjdHggJiYgY3R4LmNyZWRzKSB7CiAgICAgICAgICAgIGxvZygiZ2V0X21ldGE6IGNyZWRzIHByZXNlbnQgaW4gY29udGV4dCIsIExvZ2dpbmdMZXZlbHMuREVCVUcpOwogICAgICAgICAgICBjcmVkcyA9IGN0eC5jcmVkczsKICAgICAgICB9CiAgICAgICAgaWYgKCAhIGNyZWRzICYmIGN0eCAmJiBjdHguaGVhZGVycyAmJiBjdHguaGVhZGVycy5Db29raWUpIHsKICAgICAgICAgICAgbG9nKCJnZXRfbWV0YTogY29va2llcyBwcmVzZW50IGluIGNvbnRleHQsIGV4YW1pbmluZyIsIExvZ2dpbmdMZXZlbHMuREVCVUcpOwogICAgICAgICAgICBjb29raWVzID0gY3R4LmhlYWRlcnMuQ29va2llLnNwbGl0KCI7Iik7CiAgICAgICAgICAgIGZvciBlYWNoIChjIGluIGNvb2tpZXMpIHsKICAgICAgICAgICAgICAgIGMgPSBjLnRyaW0oKTsKICAgICAgICAgICAgICAgIGkgPSBjLmluZGV4T2YoIj0iKTsKICAgICAgICAgICAgICAgIGlmIChpID49IDApIHsKICAgICAgICAgICAgICAgICAgICBuYW1lID0gYy5zdWJzdHIoMCxpKTsKICAgICAgICAgICAgICAgICAgICBsb2coImdldF9tZXRhOiBmb3VuZCBjb29raWU6ICIgKyBuYW1lLCBMb2dnaW5nTGV2ZWxzLkRFQlVHKTsKICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gJ2F1dGhfdG9rZW4nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZygiZ2V0X21ldGE6IGZvdW5kIGNyZWRzIGluICdhdXRoX3Rva2VuJyBjb29raWUiLCBMb2dnaW5nTGV2ZWxzLkRFQlVHKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlZHMgPSAiQmVhcmVyICIgKyBkZWNvZGVVUklDb21wb25lbnQoYy5zdWJzdHIoaSsxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoICEgY3JlZHMgKSB7CiAgICAgICAgICAgIHZhciBhcGlfa2V5ID0gZ2V0X2VudigiQVBJX0tFWSIpOwogICAgICAgICAgICB2YXIgYXBpX3NlY3JldCA9IGdldF9lbnYoIkFQSV9TRUNSRVQiKTsKICAgICAgICAgICAgY3JlZHMgPSAiQmFzaWMgIiArIGphdmF4LnhtbC5iaW5kLkRhdGF0eXBlQ29udmVydGVyLnByaW50QmFzZTY0QmluYXJ5KChhcGlfa2V5ICsgIjoiICsgYXBpX3NlY3JldCkuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgICB1cmw6IG1ldGFfdXJsLAogICAgICAgIGNyZWRzOiBjcmVkcwogICAgfQp9CgoKZnVuY3Rpb24gZ2V0TG9nKCkgewogICAgcmV0dXJuIExPR19BUFBFTkRFUi50b1N0cmluZygpOwp9CgpmdW5jdGlvbiBsb2coYSwgbHZsKSB7CiAgICB2YXIgc3RyOwogICAgaWYgKCBhID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgc3RyID0gInVuZGVmaW5lZCI7CiAgICB9CiAgICBlbHNlIGlmICggYSA9PT0gbnVsbCApIHsKICAgICAgICBzdHIgPSAibnVsbCI7CiAgICB9CiAgICBlbHNlIGlmICh0eXBlb2YoYSkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgc3RyID0gSlNPTi5zdHJpbmdpZnkoYSk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBzdHIgPSBhLnRvU3RyaW5nKCk7CiAgICB9CiAgICBpZiAobHZsID09PSB1bmRlZmluZWQpIHsKICAgICAgICBsdmwgPSBMb2dnaW5nTGV2ZWxzLklORk87CiAgICB9CiAgICBpZiAobHZsID49IGxvZ2dpbmdMZXZlbHMuY29uc29sZSkgY29uc29sZS5sb2coc3RyKTsKICAgIGlmIChsdmwgPj0gbG9nZ2luZ0xldmVscy5hcHBsb2cpICBMT0dfQVBQRU5ERVIuYXBwZW5kKHN0ciArICJcbiIpOwp9CgpmdW5jdGlvbiBmcW9uKG9yZykgewogICAgcmV0dXJuIG9yZy5wcm9wZXJ0aWVzLmZxb247Cn0KCmZ1bmN0aW9uIGZpbmRfZW50aXRsZW1lbnQoZW50cywgZW50aXRsZW1lbnRfbmFtZSkgewogICAgZm9yIGVhY2ggKGUgaW4gZW50cykgaWYgKGUucHJvcGVydGllcy5hY3Rpb24gPT0gZW50aXRsZW1lbnRfbmFtZSkgcmV0dXJuIGU7CiAgICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gY29udGFpbnMoYXJyLCB2KSB7CiAgICBmb3IgZWFjaCAoYSBpbiBhcnIpIGlmIChhID09IHYpIHJldHVybiB0cnVlOwogICAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBkaXNwKHIpIHsKICAgIHJldHVybiByLm5hbWUgKyAiKCIgKyByLmlkICsgIikiCn0KCi8vIHR1cm4gQXJyYXlbRnV0dXJlW1VwZGF0ZXNdXSBpbnRvIEZ1dHVyZVtBcnJheVtVcGRhdGVzXV0KZnVuY3Rpb24gc2VxdWVuY2UoZnV0dXJlcykgewogICAgcmV0dXJuIENvbXBsZXRhYmxlRnV0dXJlLmFsbE9mKGZ1dHVyZXMpLnRoZW5BcHBseShmdW5jdGlvbihkdW1teVZhcklzTnVsbCl7CiAgICAgICAgcmV0dXJuIGZ1dHVyZXMubWFwKGZ1bmN0aW9uKGYpewogICAgICAgICAgICByZXR1cm4gZi5qb2luKCk7CiAgICAgICAgfSk7CiAgICB9KTsKfQoKCmZ1bmN0aW9uIGFkZF9lbnRpdGxlbWVudHMoYmFzZV9vcmcsIHJlc291cmNlLCBlbnRpdGxlbWVudF9uYW1lcywgaWRlbnRpdHksIGFzeW5jKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZW50aXRsZW1lbnRfbmFtZXMpKSB7CiAgICAgICAgZW50aXRsZW1lbnRfbmFtZXMgPSBbZW50aXRsZW1lbnRfbmFtZXNdOwogICAgfQogICAgdmFyIGZFbnRVcGRhdGVzID0gX0dFVCgiLyIgKyBmcW9uKGJhc2Vfb3JnKSArICIvcmVzb3VyY2VzLyIgKyByZXNvdXJjZS5pZCArICIvZW50aXRsZW1lbnRzP2V4cGFuZD10cnVlIiwgRE9fQVNZTkMpLnRoZW5Db21wb3NlKGZ1bmN0aW9uKGVudHMpIHsKICAgICAgICByZXR1cm4gc2VxdWVuY2UoZW50aXRsZW1lbnRfbmFtZXMubWFwKGZ1bmN0aW9uKGVuYW1lKXsKICAgICAgICAgICAgdmFyIGVudCA9IGZpbmRfZW50aXRsZW1lbnQoZW50cywgZW5hbWUpOwogICAgICAgICAgICBpZiAoIWVudCkgewogICAgICAgICAgICAgICAgbG9nKCJDb3VsZCBub3QgbG9jYXRlIGVudGl0bGVtZW50ICIgKyBlbmFtZSArICIgb24gcmVzb3VyY2UgIiArIGRpc3AocmVzb3VyY2UpKTsKICAgICAgICAgICAgICAgIHJldHVybiBDb21wbGV0YWJsZUZ1dHVyZS5jb21wbGV0ZWRGdXR1cmUobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGN1cl9pZHMgPSBlbnQucHJvcGVydGllcy5pZGVudGl0aWVzLm1hcChmdW5jdGlvbihpKSB7cmV0dXJuIGkuaWQ7fSk7CiAgICAgICAgICAgIGlmIChjb250YWlucyhjdXJfaWRzLCBpZGVudGl0eS5pZCkpIHsKICAgICAgICAgICAgICAgIGxvZygiRW50aXRsZW1lbnQgIiArIHJlc291cmNlLm5hbWUgKyAiWyIgKyBlbmFtZSArICJdIGFscmVhZHkgY29udGFpbnMgaWRlbnRpdHkgIiArIGRpc3AoaWRlbnRpdHkpKTsKICAgICAgICAgICAgICAgIHJldHVybiBDb21wbGV0YWJsZUZ1dHVyZS5jb21wbGV0ZWRGdXR1cmUobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG5ld19lbnQgPSB7CiAgICAgICAgICAgICAgICBpZDogZW50LmlkLAogICAgICAgICAgICAgICAgbmFtZTogZW50Lm5hbWUsCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBlbnQucHJvcGVydGllcy5hY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgaWRlbnRpdGllczogY3VyX2lkcy5jb25jYXQoaWRlbnRpdHkuaWQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxvZygiVXBkYXRpbmcgZW50aXRsZW1lbnQgIiArIHJlc291cmNlLm5hbWUgKyAiWyIgKyBlbmFtZSArICJdIHdpdGggaWRlbnRpdHkgIiArIGRpc3AoaWRlbnRpdHkpKTsKICAgICAgICAgICAgc3dpdGNoIChyZXNvdXJjZS5yZXNvdXJjZV90eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJHZXN0YWx0OjpSZXNvdXJjZTo6RW52aXJvbm1lbnQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfUFVUKCIvIiArIGZxb24oYmFzZV9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIHJlc291cmNlLmlkICsgIi9lbnRpdGxlbWVudHMvIiArIGVudC5pZCwgbmV3X2VudCwgRE9fQVNZTkMpOwogICAgICAgICAgICAgICAgY2FzZSAiR2VzdGFsdDo6UmVzb3VyY2U6OldvcmtzcGFjZSI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9QVVQoIi8iICsgZnFvbihiYXNlX29yZykgKyAiL3dvcmtzcGFjZXMvIiArIHJlc291cmNlLmlkICsgIi9lbnRpdGxlbWVudHMvIiArIGVudC5pZCwgbmV3X2VudCwgRE9fQVNZTkMpOwogICAgICAgICAgICAgICAgY2FzZSAiR2VzdGFsdDo6UmVzb3VyY2U6Ok9yZ2FuaXphdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9QVVQoIi8iICsgZnFvbihyZXNvdXJjZSkgKyAiL2VudGl0bGVtZW50cy8iICsgZW50LmlkLCBuZXdfZW50LCBET19BU1lOQyk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfUFVUKCIvIiArIGZxb24oYmFzZV9vcmcpICsgIi9lbnRpdGxlbWVudHMvIiArIGVudC5pZCwgbmV3X2VudCwgRE9fQVNZTkMpOwogICAgICAgICAgICB9CiAgICAgICAgfSkpOwogICAgfSk7CiAgICB2YXIgX2FzeW5jID0gYXN5bmMgPyBhc3luYyA6IGZhbHNlOyAvLyBqdXN0IGJlaW5nIGV4cGxpY2l0IHRoYXQgdGhlIGRlZmF1bHQgaGVyZSBpcyAnZmFsc2UnCiAgICBpZiAoX2FzeW5jKSByZXR1cm4gZkVudFVwZGF0ZXM7CiAgICByZXR1cm4gZkVudFVwZGF0ZXMuam9pbigpOwp9CgpmdW5jdGlvbiBjcmVhdGVfbWlncmF0ZV9wb2xpY3koYmFzZV9vcmcsIGVudmlyb25tZW50LCBsYW1iZGEpIHsKICAgIGxvZygiY3JlYXRpbmcgbmV3IG1pZ3JhdGUgcG9saWN5IGluICIgKyBlbnZpcm9ubWVudC5uYW1lKTsKICAgIHZhciBwb2wgPSBfUE9TVCgiLyIgKyBmcW9uKGJhc2Vfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBlbnZpcm9ubWVudC5pZCArICIvcG9saWNpZXMiLCB7CiAgICAgICAgbmFtZTogImRlZmF1bHQtbWlncmF0ZS1wb2xpY3kiLAogICAgICAgIGRlc2NyaXB0aW9uOiAiZGVmYXVsdCBjb250YWluZXIgbWlncmF0aW9uIHBvbGljeSIsCiAgICAgICAgcHJvcGVydGllczoge30KICAgIH0pOwoKICAgIGxvZygiY3JlYXRpbmcgbWlncmF0ZSBldmVudCBydWxlIGluIG1pZ3JhdGUgcG9saWN5ICIgKyBwb2wuaWQgKyAiIGFnYWluc3QgbGFtYmRhICIgKyBsYW1iZGEuaWQpOwogICAgX1BPU1QoIi8iICsgZnFvbihiYXNlX29yZykgKyAiL3BvbGljaWVzLyIgKyBwb2wuaWQgKyAiL3J1bGVzIiwgewogICAgICAgIG5hbWU6ICJtaWdyYXRpb24taGFuZGxlciIsCiAgICAgICAgZGVzY3JpcHRpb246ICJleGVjdXRlIG1pZ3JhdGUgbGFtYmRhIG9uIGNvbnRhaW5lci5taWdyYXRlLnByZSIsCiAgICAgICAgcmVzb3VyY2VfdHlwZTogIkdlc3RhbHQ6OlJlc291cmNlOjpSdWxlOjpFdmVudCIsCiAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICBhY3Rpb25zOiBbICJjb250YWluZXIubWlncmF0ZS5wcmUiIF0sCiAgICAgICAgICAgIGV2YWxfbG9naWM6IHt9LAogICAgICAgICAgICBsYW1iZGE6IGxhbWJkYS5pZAogICAgICAgIH0KICAgIH0pOwp9CgpmdW5jdGlvbiBjcmVhdGVfdXNlcihwYXJlbnRfb3JnLCBhY2NvdW50X3BheWxvYWQpIHsKICAgIGxvZygiQ3JlYXRpbmcgdXNlciAiICsgZnFvbihwYXJlbnRfb3JnKSArICIvIiArIGFjY291bnRfcGF5bG9hZC5uYW1lKTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi91c2VycyIsIGFjY291bnRfcGF5bG9hZCk7Cn0KCmZ1bmN0aW9uIGZpbmRfdXNlcihwYXJlbnRfb3JnLCB1c2VybmFtZSkgewogICAgbG9nKCJTZWFyY2hpbmcgZm9yIHVzZXIgIiArIGZxb24ocGFyZW50X29yZykgKyAiLyIgKyB1c2VybmFtZSk7CiAgICB2YXIgdXNlcnMgPSBfR0VUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL3VzZXJzL3NlYXJjaD91c2VybmFtZT0iICsgdXNlcm5hbWUpOwogICAgZm9yIGVhY2ggKHVzZXIgaW4gdXNlcnMpIGlmICh1c2VyLm5hbWUgPT0gdXNlcm5hbWUpIHJldHVybiB1c2VyOwogICAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGRlbGV0ZV91c2VyKHBhcmVudF9vcmcsIHVzZXIpIHsKICAgIGxvZygiRGVsZXRpbmcgdXNlciAiICsgZnFvbihwYXJlbnRfb3JnKSArICIvIiArIGRpc3AodXNlcikpOwogICAgcmV0dXJuIF9ERUxFVEUoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvdXNlcnMvIiArIHVzZXIuaWQpOwp9CgpmdW5jdGlvbiBjcmVhdGVfZ3JvdXAocGFyZW50X29yZywgbmFtZSwgZGVzYykgewogICAgbG9nKCJDcmVhdGluZyBncm91cCAiICsgcGFyZW50X29yZy5uYW1lICsgIi8iICsgbmFtZSk7CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvZ3JvdXBzIiwgewogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgZGVzY3JpcHRpb246IGRlc2MKICAgIH0pOwp9CgpmdW5jdGlvbiBmaW5kX2dyb3VwKHBhcmVudF9vcmcsIGdyb3VwbmFtZSkgewogICAgbG9nKCJTZWFyY2hpbmcgZm9yIGdyb3VwICIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi8iICsgZ3JvdXBuYW1lKTsKICAgIHZhciBncm91cHMgPSBfR0VUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2dyb3Vwcy9zZWFyY2g/bmFtZT0iICsgZ3JvdXBuYW1lKTsKICAgIGZvciBlYWNoIChncm91cCBpbiBncm91cHMpIGlmIChncm91cC5uYW1lID09IGdyb3VwbmFtZSkgcmV0dXJuIGdyb3VwOwogICAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGRlbGV0ZV9ncm91cChwYXJlbnRfb3JnLCBncm91cCkgewogICAgbG9nKCJEZWxldGluZyBncm91cCAiICsgZnFvbihwYXJlbnRfb3JnKSArICIvIiArIGRpc3AoZ3JvdXApKTsKICAgIHJldHVybiBfREVMRVRFKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2dyb3Vwcy8iICsgZ3JvdXAuaWQpOwp9CgpmdW5jdGlvbiBhZGRfdXNlcl90b19ncm91cChwYXJlbnRfb3JnLCBncm91cCwgdXNlcikgewogICAgbG9nKCJBZGRpbmcgdXNlciAiICsgdXNlci5uYW1lICsgIiB0byBncm91cCAiICsgZ3JvdXAubmFtZSk7CiAgICBfUEFUQ0goIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvZ3JvdXBzLyIgKyBncm91cC5pZCArICIvdXNlcnM/aWQ9IiArIHVzZXIuaWQpOwp9CgovKgogKiBwcm92aWRlcnMKICovCgpmdW5jdGlvbiBjcmVhdGVfcHJvdmlkZXIocGFyZW50X29yZywgcHJvdmlkZXJfcGF5bG9hZCkgewogICAgbG9nKCJDcmVhdGluZyBwcm92aWRlciAiICsgcHJvdmlkZXJfcGF5bG9hZC5uYW1lKTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9wcm92aWRlcnMiLCBwcm92aWRlcl9wYXlsb2FkKTsKfQoKZnVuY3Rpb24gbGlzdF9wcm92aWRlcnMob3JnLCBwcm92aWRlcl90eXBlKSB7CiAgICB2YXIgZW5kcG9pbnQgPSAiLyIgKyBmcW9uKG9yZykgKyAiL3Byb3ZpZGVycz9leHBhbmQ9dHJ1ZSI7CiAgICBpZiAocHJvdmlkZXJfdHlwZSkgZW5kcG9pbnQgPSBlbmRwb2ludCArICImdHlwZT0iICsgcHJvdmlkZXJfdHlwZTsKICAgIHJldHVybiBfR0VUKGVuZHBvaW50KTsKfQoKZnVuY3Rpb24gZmluZF9wcm92aWRlcihwYXJlbnRfb3JnLCBwcm92aWRlcl9pZCwgYXN5bmMpIHsKICAgIHJldHVybiBfR0VUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL3Byb3ZpZGVycy8iICsgcHJvdmlkZXJfaWQsIGFzeW5jKTsKfQoKZnVuY3Rpb24gcmVkZXBsb3lfcHJvdmlkZXIocGFyZW50X29yZywgcHJvdmlkZXIsIGFzeW5jKSB7CiAgICBsb2coIlJlZGVwbG95aW5nIHByb3ZpZGVyICIgKyBkaXNwKHByb3ZpZGVyKSk7CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvcHJvdmlkZXJzLyIgKyBwcm92aWRlci5pZCArICIvcmVkZXBsb3kiLCBudWxsLCBhc3luYyk7Cn0KCmZ1bmN0aW9uIHBhdGNoX3Byb3ZpZGVyKHBhcmVudF9vcmcsIHByb3ZpZGVyLCBwYXRjaCwgYXN5bmMpIHsKICAgIGxvZygiUGF0Y2hpbmcgcHJvdmlkZXIgIiArIGRpc3AocHJvdmlkZXIpKTsKICAgIHJldHVybiBfUEFUQ0goIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvcHJvdmlkZXJzLyIgKyBwcm92aWRlci5pZCwgcGF0Y2gsIGFzeW5jKTsKfQoKLyoKICogb3JncwogKi8KCmZ1bmN0aW9uIGNyZWF0ZV9vcmcocGFyZW50X29yZywgbmFtZSwgZGVzY3JpcHRpb24sIGFzeW5jKSB7CiAgICBsb2coIkNyZWF0aW5nIG9yZyAiICsgcGFyZW50X29yZy5uYW1lICsgIi8iICsgbmFtZSk7CiAgICB2YXIgcGF5bG9hZCA9IHsKICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sCiAgICAgICAgbmFtZTogbmFtZQogICAgfTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpLCBwYXlsb2FkLCBhc3luYykKfQoKZnVuY3Rpb24gZmluZF9vcmcoZnFvbiwgYXN5bmMpIHsKICAgIHJldHVybiBfR0VUKCIvIiArIGZxb24sIGFzeW5jKTsKfQoKZnVuY3Rpb24gZGVsZXRlX29yZyhvcmcsIGZvcmNlLCBhc3luYykgewogICAgdmFyIF9mb3JjZSA9IGZvcmNlID8gZm9yY2UgOiBmYWxzZTsKICAgIGxvZygiRGVsZXRpbmcgb3JnICIgKyBmcW9uKG9yZykpOwogICAgcmV0dXJuIF9ERUxFVEUoIi8iICsgZnFvbihvcmcpICsgIj9mb3JjZT0iICsgX2ZvcmNlLCBhc3luYyk7Cn0KCi8qCiAqIGVudmlyb25tZW50cwogKi8KCmZ1bmN0aW9uIGNyZWF0ZV9lbnZpcm9ubWVudChwYXJlbnRfb3JnLCBwYXJlbnRfd29ya3NwYWNlLCBuYW1lLCBkZXNjcmlwdGlvbiwgdHlwZSwgYXN5bmMsIGYpIHsKICAgIGxvZygiQ3JlYXRpbmcgZW52aXJvbm1lbnQgIiArIHBhcmVudF93b3Jrc3BhY2UubmFtZSArICIvIiArIG5hbWUpOwogICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLAogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICBlbnZpcm9ubWVudF90eXBlOiB0eXBlCiAgICAgICAgfQogICAgfTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi93b3Jrc3BhY2VzLyIgKyBwYXJlbnRfd29ya3NwYWNlLmlkICsgIi9lbnZpcm9ubWVudHMiLCBwYXlsb2FkLCBhc3luYywgZik7Cn0KCmZ1bmN0aW9uIGZpbmRfZW52aXJvbm1lbnQocGFyZW50X29yZywgZW52aXJvbm1lbnRfaWQsIGFzeW5jKSB7CiAgICByZXR1cm4gX0dFVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIGVudmlyb25tZW50X2lkLCBhc3luYyk7Cn0KCi8qCiAqIHdvcmtzcGFjZXMKICovCgpmdW5jdGlvbiBjcmVhdGVfd29ya3NwYWNlKHBhcmVudF9vcmcsIG5hbWUsIGRlc2NyaXB0aW9uLCBhc3luYywgZikgewogICAgbG9nKCJDcmVhdGluZyB3b3Jrc3BhY2UgIiArIHBhcmVudF9vcmcubmFtZSArICIvIiArIG5hbWUpOwogICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLAogICAgICAgIG5hbWU6IG5hbWUKICAgIH07CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvd29ya3NwYWNlcyIsIHBheWxvYWQsIGFzeW5jLCBmKTsKfQoKLyoKICogbGFtYmRhcwogKi8KCmZ1bmN0aW9uIGNyZWF0ZV9sYW1iZGEocGFyZW50X29yZywgcGFyZW50X2VudiwgbGFtYmRhX3BheWxvYWQpIHsKICAgIGxvZygiQ3JlYXRpbmcgbGFtYmRhICIgKyBwYXJlbnRfZW52Lm5hbWUgKyAiLyIgKyBsYW1iZGFfcGF5bG9hZC5uYW1lKTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIHBhcmVudF9lbnYuaWQgKyAiL2xhbWJkYXMiLCBsYW1iZGFfcGF5bG9hZCk7Cn0KCi8qCiAqIGNvbnRhaW5lcnMKICovCgpmdW5jdGlvbiBjcmVhdGVfY29udGFpbmVyKHBhcmVudF9vcmcsIHBhcmVudF9lbnYsIHBheWxvYWQsIGFzeW5jKSB7CiAgICBsb2coIkNyZWF0aW5nIGNvbnRhaW5lciAiICsgcGF5bG9hZC5uYW1lICsgIiBpbiAiICsgZnFvbihwYXJlbnRfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBwYXJlbnRfZW52LmlkKTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIHBhcmVudF9lbnYuaWQgKyAiL2NvbnRhaW5lcnMiLCBwYXlsb2FkLCBhc3luYyk7Cn0KCmZ1bmN0aW9uIGZpbmRfY29udGFpbmVyX2J5X25hbWUocGFyZW50X29yZywgcGFyZW50X2VudiwgbmFtZSkgewogICAgdmFyIGVuZHBvaW50ID0gIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvZW52aXJvbm1lbnRzLyIgKyBwYXJlbnRfZW52LmlkICsgIi9jb250YWluZXJzP2V4cGFuZD10cnVlIjsKICAgIHZhciBjb250YWluZXJzID0gX0dFVChlbmRwb2ludCk7CiAgICBmb3IgZWFjaCAoYyBpbiBjb250YWluZXJzKSBpZiAoYy5uYW1lID09IG5hbWUpIHJldHVybiBjOwogICAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGRlbGV0ZV9jb250YWluZXIocGFyZW50X29yZywgcGFyZW50X2VudiwgY29udGFpbmVyLCBhc3luYywgZm9yY2UpIHsKICAgIF9mb3JjZSA9IGZvcmNlID8gZm9yY2UgOiBmYWxzZTsKICAgIGxvZygiRGVsZXRpbmcgY29udGFpbmVyICIgKyBkaXNwKGNvbnRhaW5lcikgKyAiIGZyb20gIiArIGZxb24ocGFyZW50X29yZykgKyAiL2Vudmlyb25tZW50cy8iICsgcGFyZW50X2Vudi5pZCk7CiAgICByZXR1cm4gX0RFTEVURSgiLyIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIHBhcmVudF9lbnYuaWQgKyAiL2NvbnRhaW5lcnMvIiArIGNvbnRhaW5lci5pZCArICI/Zm9yY2U9IiArIF9mb3JjZSxhc3luYyk7Cn0KCmZ1bmN0aW9uIHBhdGNoX2NvbnRhaW5lcihwYXJlbnRfb3JnLCBwYXJlbnRfZW52LCBjb250YWluZXIsIHBhdGNoLCBhc3luYykgewogICAgbG9nKCJQYXRjaGluZyBjb250YWluZXIgIiArIGRpc3AoY29udGFpbmVyKSk7CiAgICByZXR1cm4gX1BBVENIKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2Vudmlyb25tZW50cy8iICsgcGFyZW50X2Vudi5pZCArICIvY29udGFpbmVycy8iICsgY29udGFpbmVyLmlkLCBwYXRjaCwgYXN5bmMpOwp9CgpmdW5jdGlvbiB1cGRhdGVfY29udGFpbmVyKHBhcmVudF9vcmcsIGNvbnRhaW5lciwgYXN5bmMpIHsKICAgIGxvZygiVXBkYXRpbmcgY29udGFpbmVyICIgKyBkaXNwKGNvbnRhaW5lcikpOwogICAgcmV0dXJuIF9QVVQoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvY29udGFpbmVycy8iICsgY29udGFpbmVyLmlkLCBjb250YWluZXIsIGFzeW5jKTsKfQoKLyoKICogYXBpcwogKi8KCmZ1bmN0aW9uIGNyZWF0ZV9hcGkocGFyZW50X29yZywgcGFyZW50X2VudiwgcGF5bG9hZCwgYXN5bmMpIHsKICAgIGxvZygiQ3JlYXRpbmcgYXBpICIgKyBwYXlsb2FkLm5hbWUgKyAiIGluICIgKyBmcW9uKHBhcmVudF9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIHBhcmVudF9lbnYuaWQpOwogICAgcmV0dXJuIF9QT1NUKCIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2Vudmlyb25tZW50cy8iICsgcGFyZW50X2Vudi5pZCArICIvYXBpcyIsIHBheWxvYWQsIGFzeW5jKTsKfQoKZnVuY3Rpb24gZmluZF9hcGkocGFyZW50X29yZywgYXBpX2lkLCBhc3luYykgewogICAgcmV0dXJuIF9HRVQoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvYXBpcy8iICsgYXBpX2lkLCBhc3luYyk7Cn0KCi8qCiAqIGFwaWVuZHBvaW50cwogKi8KCmZ1bmN0aW9uIGNyZWF0ZV9hcGllbmRwb2ludChwYXJlbnRfb3JnLCBwYXJlbnRfYXBpLCBwYXlsb2FkLCBhc3luYykgewogICAgbG9nKCJDcmVhdGluZyBhcGllbmRwb2ludCAiICsgcGF5bG9hZC5uYW1lICsgIiBpbiAiICsgZnFvbihwYXJlbnRfb3JnKSArICIvYXBpcy8iICsgcGFyZW50X2FwaS5pZCk7CiAgICByZXR1cm4gX1BPU1QoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvYXBpcy8iICsgcGFyZW50X2FwaS5pZCArICIvYXBpZW5kcG9pbnRzIiwgcGF5bG9hZCwgYXN5bmMpOwp9CgpmdW5jdGlvbiBsaXN0X2NvbnRhaW5lcl9hcGllbmRwb2ludHMob3JnLCBjb250YWluZXIpIHsKICAgIHZhciBlbmRwb2ludCA9ICIvIiArIGZxb24ob3JnKSArICIvYXBpZW5kcG9pbnRzP2V4cGFuZD10cnVlJmltcGxlbWVudGF0aW9uX3R5cGU9Y29udGFpbmVyJmltcGxlbWVudGF0aW9uX2lkPSIgKyBjb250YWluZXIuaWQ7CiAgICByZXR1cm4gX0dFVChlbmRwb2ludCk7Cn0KCmZ1bmN0aW9uIGxpc3RfbGFtYmRhX2FwaWVuZHBvaW50cyhvcmcsIGxhbWJkYSkgewogICAgdmFyIGVuZHBvaW50ID0gIi8iICsgZnFvbihvcmcpICsgIi9hcGllbmRwb2ludHM/ZXhwYW5kPXRydWUmaW1wbGVtZW50YXRpb25fdHlwZT1sYW1iZGEmaW1wbGVtZW50YXRpb25faWQ9IiArIGxhbWJkYS5pZDsKICAgIHJldHVybiBfR0VUKGVuZHBvaW50KTsKfQoKZnVuY3Rpb24gZGVsZXRlX2VuZHBvaW50KHBhcmVudF9vcmcsIGVuZHBvaW50LCBhc3luYykgewogICAgbG9nKCJEZWxldGluZyBlbmRwb2ludCAiICsgZGlzcChlbmRwb2ludCkgKyAiIGZyb20gIiArIGZxb24ocGFyZW50X29yZykpOwogICAgcmV0dXJuIF9ERUxFVEUoIi8iICsgZnFvbihwYXJlbnRfb3JnKSArICIvYXBpZW5kcG9pbnRzLyIgKyBlbmRwb2ludC5pZCwgYXN5bmMpOwp9CgpmdW5jdGlvbiB1cGRhdGVfZW5kcG9pbnRfdGFyZ2V0KG9yZywgZW5kcG9pbnQsIG5ld190YXJnZXQpIHsKICAgIHZhciBwYXRjaCA9IFt7CiAgICAgICAgb3A6ICJyZXBsYWNlIiwKICAgICAgICBwYXRoOiAiL3Byb3BlcnRpZXMvaW1wbGVtZW50YXRpb25faWQiLAogICAgICAgIHZhbHVlOiBuZXdfdGFyZ2V0LmlkCiAgICB9XTsKICAgIGxvZyhKU09OLnN0cmluZ2lmeShwYXRjaCkpOwogICAgdmFyIHVybCA9ICIvIiArIGZxb24ob3JnKSArICIvYXBpZW5kcG9pbnRzLyIgKyBlbmRwb2ludC5pZDsKICAgIHJldHVybiBfUEFUQ0godXJsLCBwYXRjaCk7Cn0KCmZ1bmN0aW9uIGZpbmRfZW5kb2ludF9ieV9uYW1lKHBhcmVudF9vcmcsIHBhcmVudF9hcGksIG5hbWUpIHsKICAgIHZhciBlbmRwb2ludCA9ICIvIiArIGZxb24ocGFyZW50X29yZykgKyAiL2FwaXMvIiArIHBhcmVudF9hcGkuaWQgKyAiL2FwaWVuZHBvaW50cz9leHBhbmQ9dHJ1ZSI7CiAgICB2YXIgZXBzID0gX0dFVChlbmRwb2ludCk7CiAgICBmb3IgZWFjaCAoZXAgaW4gZXBzKSBpZiAoZXAubmFtZSA9PSBuYW1lKSByZXR1cm4gZXA7CiAgICByZXR1cm4gbnVsbDsKfQoKLyoKICogcG9saWN5CiAqLwoKZnVuY3Rpb24gY3JlYXRlX3BvbGljeShiYXNlX29yZywgZW52aXJvbm1lbnQsIG5hbWUsIGRlc2NyaXB0aW9uKSB7CiAgICBsb2coImNyZWF0aW5nIG5ldyBwb2xpY3kgaW4gIiArIGVudmlyb25tZW50Lm5hbWUpOwogICAgcmV0dXJuIF9QT1NUKCIvIiArIGZxb24oYmFzZV9vcmcpICsgIi9lbnZpcm9ubWVudHMvIiArIGVudmlyb25tZW50LmlkICsgIi9wb2xpY2llcyIsIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiA/IGRlc2NyaXB0aW9uIDogIiIsCiAgICAgICAgcHJvcGVydGllczoge30KICAgIH0pOwp9CgpmdW5jdGlvbiBjcmVhdGVfZXZlbnRfcnVsZShiYXNlX29yZywgcG9saWN5LCBuYW1lLCBkZXNjcmlwdGlvbiwgbGFtYmRhSWQsIG1hdGNoX2FjdGlvbnMpIHsKICAgIGxvZygiY3JlYXRpbmcgbmV3IGV2ZW50IHJ1bGUgaW4gIiArIHBvbGljeS5uYW1lKTsKICAgIHJldHVybiBfUE9TVCgiLyIgKyBmcW9uKGJhc2Vfb3JnKSArICIvcG9saWNpZXMvIiArIHBvbGljeS5pZCArICIvcnVsZXMiLCB7CiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gPyBkZXNjcmlwdGlvbiA6ICIiLAogICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgcGFyZW50OiB7fSwKICAgICAgICAgICAgbGFtYmRhOiBsYW1iZGFJZCwKICAgICAgICAgICAgbWF0Y2hfYWN0aW9uczogbWF0Y2hfYWN0aW9ucwogICAgICAgIH0sCiAgICAgICAgcmVzb3VyY2VfdHlwZTogIkdlc3RhbHQ6OlJlc291cmNlOjpSdWxlOjpFdmVudCIKICAgIH0pOwp9CgpmdW5jdGlvbiBjcmVhdGVfbGltaXRfcnVsZShiYXNlX29yZywgcG9saWN5LCBuYW1lLCBkZXNjcmlwdGlvbiwgbWF0Y2hfYWN0aW9ucywgcHJvcGVydHksIG9wZXJhdG9yLCB2YWx1ZSkgewogICAgbG9nKCJjcmVhdGluZyBuZXcgbGltaXQgcnVsZSBpbiAiICsgcG9saWN5Lm5hbWUpOwogICAgcmV0dXJuIF9QT1NUKCIvIiArIGZxb24oYmFzZV9vcmcpICsgIi9wb2xpY2llcy8iICsgcG9saWN5LmlkICsgIi9ydWxlcyIsewogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uID8gZGVzY3JpcHRpb24gOiAiIiwKICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgIHBhcmVudDoge30sCiAgICAgICAgICAgIHN0cmljdDogZmFsc2UsCiAgICAgICAgICAgIG1hdGNoX2FjdGlvbnM6IG1hdGNoX2FjdGlvbnMsCiAgICAgICAgICAgIGV2YWxfbG9naWM6IHsKICAgICAgICAgICAgICAgIHByb3BlcnR5OiBwcm9wZXJ0eSwKICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBvcGVyYXRvciwKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZXNvdXJjZV90eXBlOiAiR2VzdGFsdDo6UmVzb3VyY2U6OlJ1bGU6OkxpbWl0IgogICAgfSk7Cn0KCi8qCiAqIFJlc291cmNlVHlwZXMgYW5kIFByb3BlcnR5RGVmaW5pdGlvbnMKICovCgpmdW5jdGlvbiBnZXRfcmVzb3VyY2V0eXBlX2J5X2lkKGJhc2Vfb3JnLCBpZCkgewogICAgbG9nKCJnZXR0aW5nIHJlc291cmNlIHR5cGUgd2l0aCBpZCAiICsgaWQpOwogICAgdmFyIGVuZHBvaW50ID0gIi8iICsgZnFvbihiYXNlX29yZykgKyAiL3Jlc291cmNldHlwZXMvIiArIGlkICsgIj93aXRocHJvcHM9dHJ1ZSI7CiAgICByZXR1cm4gX0dFVChlbmRwb2ludCk7Cn0KCgovKgogKiBSRVNUIHV0aWxpdGllcwogKi8KCmZ1bmN0aW9uIF9oYW5kbGVSZXNwb25zZShyZXNwb25zZSkgewogICAgdmFyIGNvZGUgPSByZXNwb25zZS5nZXRTdGF0dXNDb2RlKCk7CiAgICB2YXIgYm9keSA9IHJlc3BvbnNlLmdldFJlc3BvbnNlQm9keSgpOwogICAgaWYgKGNvZGUgPT0gNDA0KSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9IGVsc2UgaWYgKGNvZGUgPj0gMzAwKSB7CiAgICAgICAgbG9nKCJXQVJOSU5HOiBzdGF0dXMgY29kZSAiICsgY29kZSArICIgZnJvbSAiICsgcmVzcG9uc2UuZ2V0VXJpKCkpOwogICAgICAgIGxvZygicmVzcG9uc2U6ICIgKyBib2R5KTsKICAgICAgICB0aHJvdyBjb2RlOwogICAgfSBlbHNlIGlmIChjb2RlID09IDIwNCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKHJlc3BvbnNlLmdldENvbnRlbnRUeXBlKCkgJiYgcmVzcG9uc2UuZ2V0Q29udGVudFR5cGUoKS5zdGFydHNXaXRoKCJhcHBsaWNhdGlvbi9qc29uIikpIHJldHVybiBKU09OLnBhcnNlKGJvZHkpOwogICAgcmV0dXJuIGJvZHk7Cn0KCmZ1bmN0aW9uIF9SRVNUX0pTT04obWV0aG9kLCBlbmRwb2ludCwgcGF5bG9hZCwgYXN5bmMsIGZSZXNwb25zZSkgewogICAgdmFyIHVybCA9IE1FVEEudXJsICsgZW5kcG9pbnQ7CiAgICB2YXIgcGMgPSBjbGllbnQucHJlcGFyZUNvbm5lY3QodXJsKQogICAgICAgIC5zZXRNZXRob2QobWV0aG9kKQogICAgICAgIC5hZGRIZWFkZXIoIkF1dGhvcml6YXRpb24iLCBNRVRBLmNyZWRzKTsKICAgIGxvZyhtZXRob2QgKyAiICIgKyB1cmwsIExvZ2dpbmdMZXZlbHMuREVCVUcpOwogICAgaWYgKHBheWxvYWQpIHsKICAgICAgICBwYyA9IHBjLnNldEJvZHkoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpLmFkZEhlYWRlcigiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb24iKQogICAgfQogICAgdmFyIF9hc3luYyA9IGFzeW5jID8gYXN5bmMgOiBmYWxzZTsgLy8ganVzdCBiZWluZyBleHBsaWNpdCB0aGF0IHRoZSBkZWZhdWx0IGhlcmUgaXMgJ2ZhbHNlJwogICAgaWYgKF9hc3luYykgewogICAgICAgIGlmICghZlJlc3BvbnNlKSBmUmVzcG9uc2UgPSBuZXcgQ29tcGxldGFibGVGdXR1cmUoKTsKICAgICAgICBwYy5leGVjdXRlKG5ldyBvcmcuYXN5bmNodHRwY2xpZW50LkFzeW5jQ29tcGxldGlvbkhhbmRsZXIoewogICAgICAgICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIGZSZXNwb25zZS5jb21wbGV0ZShfaGFuZGxlUmVzcG9uc2UocmVzcG9uc2UpKTsKICAgICAgICAgICAgfQogICAgICAgIH0pKTsKICAgICAgICByZXR1cm4gZlJlc3BvbnNlOwogICAgfQogICAgcmV0dXJuIF9oYW5kbGVSZXNwb25zZShwYy5leGVjdXRlKCkuZ2V0KCkpOwp9CgpmdW5jdGlvbiBfREVMRVRFKGVuZHBvaW50LCBhc3luYywgZlJlc3BvbnNlKSB7CiAgICByZXR1cm4gX1JFU1RfSlNPTigiREVMRVRFIiwgZW5kcG9pbnQsIG51bGwsIGFzeW5jLCBmUmVzcG9uc2UpOwp9CgpmdW5jdGlvbiBfR0VUKGVuZHBvaW50LCBhc3luYywgZlJlc3BvbnNlKSB7CiAgICByZXR1cm4gX1JFU1RfSlNPTigiR0VUIiwgZW5kcG9pbnQsIG51bGwsIGFzeW5jLCBmUmVzcG9uc2UpOwp9CgpmdW5jdGlvbiBfUE9TVChlbmRwb2ludCwgcGF5bG9hZCwgYXN5bmMsIGZSZXNwb25zZSkgewogICAgcmV0dXJuIF9SRVNUX0pTT04oIlBPU1QiLCBlbmRwb2ludCwgcGF5bG9hZCwgYXN5bmMsIGZSZXNwb25zZSk7Cn0KCmZ1bmN0aW9uIF9QVVQoZW5kcG9pbnQsIHBheWxvYWQsIGFzeW5jLCBmUmVzcG9uc2UpIHsKICAgIHJldHVybiBfUkVTVF9KU09OKCJQVVQiLCBlbmRwb2ludCwgcGF5bG9hZCwgYXN5bmMsIGZSZXNwb25zZSk7Cn0KCmZ1bmN0aW9uIF9QQVRDSChlbmRwb2ludCwgcGF5bG9hZCwgYXN5bmMsIGZSZXNwb25zZSkgewogICAgcmV0dXJuIF9SRVNUX0pTT04oIlBBVENIIiwgZW5kcG9pbnQsIHBheWxvYWQsIGFzeW5jLCBmUmVzcG9uc2UpOwp9Cg==",
        "code_type": "code",
        "cpus": 0.1,
        "memory": 128,
        "timeout": 60,
        "pre_warm": 0,
        "handler": "promote",
        "public": true,
        "runtime": "nashorn",
        "provider": {
            "id": "#{Provider /root/default-laser id}",
            "locations": []
        },
        "periodic_info": {},
        "secrets": [],
        "apiendpoints": []
    }
}
